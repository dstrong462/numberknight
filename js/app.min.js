function titleScreen(){document.body.style.height="100vh";var e=document.getElementById("btn-new-game");e.addEventListener("click",function(){function e(e){var t=options.avatars.indexOf(avatarSelection);0===t&&"left"===e?t=options.avatars.length-1:t===options.avatars.length-1&&"right"===e?t=0:t>0&&"left"===e?t--:t<options.avatars.length-1&&"right"===e?t++:t=0,avatarSelection=options.avatars[t],n.src="img/avatars/"+avatarSelection+".gif"}var t=document.querySelector(".flipper");t.style.transform="rotateY(-180deg)",gameMode=["multiples","factors","primes","equality"],document.getElementById("multiples").checked=!0,document.getElementById("factors").checked=!0,document.getElementById("primes").checked=!0,document.getElementById("equality").checked=!0;var o=document.getElementById("avatar-selector");if(o.style.display="none",options.avatars.length>1){o.style.display="flex";var r=document.getElementById("avatar-left");r.addEventListener("click",function(){e("left")});var a=document.getElementById("avatar-right");a.addEventListener("click",function(){e("right")});var n=document.getElementById("selected-avatar");n.src="img/avatars/hero.gif",avatarSelection="hero"}});var t=document.getElementById("btn-continue");t.addEventListener("click",function(){var e=localStorage.getItem("savedGame");hero=JSON.parse(e),options.newgame=!1,startGame()});for(var o=document.querySelectorAll(".btn-options"),r=0;r<o.length;r++)o[r].addEventListener("click",function(e){"title-screen"===e.target.offsetParent.id?document.querySelector("#options-menu .return-to-main-menu").style.display="none":"top-bar"===e.target.parentElement.id&&(document.querySelector("#options-menu .return-to-main-menu").style.display="inline-block");var t=document.getElementById("options-menu");"closed"===optionsPosition?(hero.pause=!0,t.style.transform="translateX(0)",optionsPosition="open"):(hero.pause=!1,setOptions(),t.style.transform="translateX(-100%)",optionsPosition="closed")});var a=document.getElementById("enable-tutorial");options.tutorial?a.checked=!0:a.checked=!1,a.addEventListener("click",function(e){e.target.checked?options.tutorial=!0:e.target.checked||(options.tutorial=!1)});var n=document.getElementById("btn-gamemodes");n.addEventListener("click",showGamemodes);var i=document.getElementById("btn-main-menu");i.addEventListener("click",function(){var e=document.querySelector(".flipper");e.style.transform="rotateY(0deg)"});var l=document.getElementById("btn-play");l.addEventListener("click",function(e){delete hero,hero={},hero.name=document.getElementById("name-input").value,hero.difficultyMath=document.querySelector('input[name="mathradio"]:checked').value,hero.difficultyMonster=document.querySelector('input[name="monsterradio"]:checked').value,0===hero.name.length?alert("Please name your character."):hero.name.length>20?alert("In this world no name is longer than 20 characters long."):0===gameMode.length?alert("That would be too easy. Select at least 1 game mode."):hero.name.length>0&&hero.name.length<=20&&hero.difficultyMath&&hero.difficultyMonster&&gameMode.length>=1&&(options.newgame=!0,startGame())});var s=document.getElementById("multiples");s.addEventListener("click",adjustGameMode);var m=document.getElementById("factors");m.addEventListener("click",adjustGameMode);var c=document.getElementById("primes");c.addEventListener("click",adjustGameMode);var d=document.getElementById("equality");d.addEventListener("click",adjustGameMode);var h=document.querySelector(".return-to-main-menu");h.addEventListener("click",function(){fadeToMainMenu(fadeIn)}),titleButtons()}function titleButtons(){if(null===localStorage.getItem("savedGame")){savedGame=[];var e=document.getElementById("btn-continue");e.style.display="none"}else{var t=localStorage.getItem("savedGame");savedGame=JSON.parse(t);var e=document.getElementById("btn-continue");e.style.display="inline-block"}if(options.enemiesEncountered.length>0){var o=document.getElementById("btn-bestiary");if(o.addEventListener("click",displayBestiary),o.style.display="flex",options.newEnemies>0){var r=document.getElementById("btn-bestiary-new");r.innerHTML=options.newEnemies,r.style.display="flex"}}if(fallenHeroes.length>0?document.getElementById("btn-fallen-heroes").style.display="flex":document.getElementById("btn-fallen-heroes").style.display="none",options.gold>0){var a=document.querySelector(".gold-total span");a.parentElement.style.display="flex",a.innerHTML=options.gold.toLocaleString()}}function setOptions(){soundfx.checked?options.soundfx=!0:options.soundfx=!1,music.checked?options.music=!0:options.music=!1,localStorage.setItem("options",JSON.stringify(options))}function adjustDifficulty(e){if("mathradio"===e.target.name)var t=mathradio;else if("monsterradio"===e.target.name)var t=monsterradio;for(var o=1;o<t.length;o++)t[o].nextElementSibling.firstChild.style.backgroundImage='url("img/gui/star-off.svg")';for(var o=0;o<e.target.value;o++)t[o].nextElementSibling.firstChild.style.backgroundImage='url("img/gui/star-on.svg")'}function adjustGameMode(e){var t=gameMode.indexOf(e.target.id);e.target.checked&&t===-1?gameMode.push(e.target.id):e.target.checked||t===-1||gameMode.splice(t,1)}function displayHeroes(){function e(){setTimeout(function(){if(fallenHeroes.length>0){var t=document.createElement("div");t.classList.add("row"),t.id="fallen-"+l;var r="<div><span>"+fallenHeroes[l].name+"</span>";r+="<span>Floor "+fallenHeroes[l].gameLevel+"</span></div>",r+="Quest Complete"===fallenHeroes[l].death?'<p class="complete">'+fallenHeroes[l].death+"</p>":"<p>"+fallenHeroes[l].death+"</p>",t.innerHTML=r,o.appendChild(t);var a=document.getElementById(t.id);a.addEventListener("click",function(){var e=a.id.split("-").pop();listFallenStats(fallenHeroes[e],"fallen-heroes")}),t=o.lastChild,t.style.transition="opacity .5s",setTimeout(function(){t.style.opacity="1"},200),l++,l<fallenHeroes.length&&e()}},100)}var t=document.getElementById("fallen-heroes");t.innerHTML="";var o=document.createElement("div");o.classList.add("scroll"),t.appendChild(o);var r="<h5>Fallen Heroes</h5><br />";o.innerHTML=r,t.style.display="flex",window.scroll(0,0),t.style.opacity=1;var a=document.createElement("div");a.innerHTML='<button></button><button id="clearlist"></button>',t.appendChild(a);var n=document.querySelector("#fallen-heroes button");n.addEventListener("click",function(){o.remove(),t.innerHTML="",t.style.display="none"});var i=document.getElementById("clearlist");i.addEventListener("click",clearList),0===fallenHeroes.length&&(i.style.display="none");var l=0;e()}function clearList(){if(confirm("This will clear your Fallen Heroes list. Are you sure about this?")){localStorage.removeItem("fallenHeroes"),delete fallenHeroes,fallenHeroes=[];var e=document.getElementById("fallen-heroes");e.remove(),displayHeroes(),document.getElementById("btn-fallen-heroes").style.display="none"}}function showGamemodes(e){var t=document.getElementById("tutorial");t.innerHTML="",t.style.backgroundImage='url("img/backgrounds/background-0'+randomNumber(1,backgrounds)+'.gif")';var o=document.createElement("div");o.classList.add("scroll");var r="<h5>Game Modes</h5>";r+="<br />",r+="<h6>Multiples</h6>",r+="<p>Find and capture tiles that are MULTIPLES of the number given. Multiples of 5 would be 5, 10, 15, 20, etc.</p>",r+="<h6>Factors</h6>",r+="<p>Find and capture tiles that evenly divide into the given number. Factors of 20 would be 1, 2, 4, 5, and so on.</p>",r+="<h6>Prime Numbers</h6>",r+="<p>These are numbers that are only divisible by 1 and themselves. Examples of prime numbers are 3, 5, 7, and 11.</p>",r+="<h6>Equality</h6>",r+="<p>Select equations that equal the given number. Examples for Equals 6 would include 2+4, and 12&divide;2.</p>",r+="<br />",r+="<h5>Challenge Levels</h5>",r+="<p>Challenge levels are not part of the normal rotation, but will occur every few levels to mix things up.</p>",r+="<br />",r+="<h6>Ascending Order</h6>",r+="<p>Capture the tiles in ascending order from lowest number to highest.</p>",r+="<h6>Descending Order</h6>",r+="<p>Capture the tiles in descending order from highest number to lowest.</p>",r+='<div class="row"><button class="btn-back"></button></div>',o.innerHTML=r,t.appendChild(o);var a=document.querySelector("#tutorial .btn-back");a.addEventListener("click",function(){localStorage.setItem("options",JSON.stringify(options)),t.style.display="none",t.innerHTML=""}),t.style.display="flex",window.scroll(0,0),t.style.opacity="1"}function displayBestiary(){var e=document.getElementById("bestiary");e.innerHTML="",e.style.backgroundImage='url("img/backgrounds/background-0'+randomNumber(1,backgrounds)+'.gif")';for(var t='<div class="scroll"><h5>Monster Manual</h5>',o=0;o<options.enemiesEncountered.length;o++){var r=bestiary.filter(function(e){return e.type===options.enemiesEncountered[o]})[0];if(void 0===r)var r=bosses.filter(function(e){return e.type===options.enemiesEncountered[o]})[0];t+='<div class="bestiary">',t+='<img src="img/enemies/'+r.image+'" />',t+="<div><h6>"+r.type+"</h6>",t+="<p>"+r.info+"</p></div></div>"}t+='<button class="btn-back"></button></div>',e.innerHTML=t,e.style.height="auto";var a=document.querySelector("#bestiary button");a.addEventListener("click",function(){e.style.display="none",e.innerHTML=""}),e.style.display="flex",e.style.opacity="1",window.scroll(0,0),options.newEnemies=0,localStorage.setItem("options",JSON.stringify(options));var n=document.getElementById("btn-bestiary-new");n.style.display="none"}function listFallenStats(e,t){var o=document.getElementById("game-over");o.innerHTML="",o.style.backgroundImage='url("img/backgrounds/background-0'+randomNumber(1,backgrounds)+'.gif")';var r=document.createElement("div");r.classList.add("scroll");var a="<h5>"+e.name+"</h5>";if(a+='<img src="img/avatars/'+e.avatar+'.gif">',a+="<p>Level: <span>"+e.level+"</span></p>",a+="<p>strength: <span>"+e.strength+"</span></p>",a+="<p>Dexterity: <span>"+e.dexterity+"</span></p>",a+="<p>Endurance: <span>"+e.endurance+"</span></p>",a+="<p>Dungeon Level: <span>"+e.gameLevel+"</span></p>",a+="<p>Math Difficulty: <span>"+e.difficultyMath+"</span></p>",a+="<p>Monster Difficulty: <span>"+e.difficultyMonster+"</span></p>",a+="Quest Complete"===e.death?'<p class="win">'+e.death+"</p>":'<p class="death">'+e.death+"</p>",a+="<h6>Accuracy</h6>",a+="<p>Multiples: <span>"+getAccuracy(e.multiplesRight,e.multiplesWrong)+"</span></p>",a+="<p>Factors: <span>"+getAccuracy(e.factorsRight,e.factorsWrong)+"</span></p>",a+="<p>Primes: <span>"+getAccuracy(e.primesRight,e.primesWrong)+"</span></p>",a+="<p>Equality: <span>"+getAccuracy(e.equalsRight,e.equalsWrong)+"</span></p>",a+="<h6>Fun Stats</h6>",a+="<p>Spaces Moved: <span>"+e.squaresMoved+"</span></p>",a+="<p>Enemies Slain: <span>"+e.enemiesSlain+"</span></p>",a+="<p>Traps Evaded: <span>"+e.trapsEvaded+"</span></p>",a+="<p>Attacks Evaded: <span>"+e.attacksEvaded+"</span></p>",a+="<p>Times Frozen: <span>"+e.timesFrozen+"</span></p>",a+="<p>Times Spider Webbed: <span>"+e.timesWebbed+"</span></p>",a+="<p>Times Poisoned: <span>"+e.timesPoisoned+"</span></p>",r.innerHTML=a,o.appendChild(r),o.style.opacity="0",o.style.display="flex","game-over"===t){var n=document.createElement("button");n.classList.add("main-menu-button"),n.innerHTML="Main Menu",n.addEventListener("click",function(){fadeToMainMenu(fadeIn)})}else{var n=document.createElement("button");n.classList.add("btn-back"),n.addEventListener("click",function(){o.style.display="none"})}r.appendChild(n),window.scroll(0,0),setTimeout(function(){o.style.opacity="1"},200)}function openStore(){function e(){u=this.parentElement.id,t()}function t(){var e=options.storeItems.filter(function(e){return e.id===u})[0];options.gold>=e.cost?confirm("Ready to buy?")&&(e.owned=!0,o(e)):alert("Come back when you have enough gold!")}function o(t){if("avatars"===t.type)for(var o=0;o<t.images.length;o++)options.avatars.push(t.images[o]);var r=document.querySelector("#"+u+" .store-button");r.classList.add("purchased"),r.classList.remove("store-button"),r.innerHTML="owned",r.removeEventListener("click",e);var a=options.gold-t.cost;setTimeout(function(){var e=setInterval(function(){if(options.gold>a){options.gold-=10;for(var t=0;t<f.length;t++)f[t].innerHTML=options.gold.toLocaleString()}else{clearInterval(e),options.gold=a;for(var t=0;t<f.length;t++)f.innerHTML=options.gold.toLocaleString()}},50);localStorage.setItem("options",JSON.stringify(options))},1e3)}var r=document.getElementById("store");r.innerHTML="",r.style.opacity="0",r.style.display="none",r.style.backgroundImage='url("img/backgrounds/background-0'+randomNumber(1,backgrounds)+'.gif")';var a=document.createElement("div");a.classList.add("scroll");var n="<h5>- Ye Olde Store -</h5><br />";n+="<p>Put your hard earned gold to good use with these unlockable items!</p><p>Or don&apos;t. It&apos;s your gold.</p><br />",a.innerHTML=n;for(var i=0;i<options.storeItems.length;i++){var l=document.createElement("div");l.id=options.storeItems[i].id,l.classList.add("store-item");var s=document.createElement("h6");s.innerHTML=options.storeItems[i].item,l.appendChild(s);for(var m=0;m<options.storeItems[i].images.length;m++){var c=document.createElement("img");c.src=options.storeItems[i].imagePath+options.storeItems[i].images[m]+".gif",l.appendChild(c)}var d=document.createElement("br");if(l.appendChild(d),options.storeItems[i].owned){var h=document.createElement("span");h.classList.add("purchased"),h.innerHTML="owned"}else{var h=document.createElement("span");h.classList.add("store-button"),h.innerHTML='<img src="img/loot/gold-2.gif">'+options.storeItems[i].cost,h.addEventListener("click",e)}l.appendChild(h),a.appendChild(l),r.appendChild(a)}setTimeout(function(){r.style.display="flex",window.scroll(0,0),r.style.opacity="1"},200);var u,p=document.createElement("div");p.classList.add("row"),p.style.marginTop="50px",p.style.marginBottom="50px";var h=document.createElement("button");h.classList.add("btn-back"),h.addEventListener("click",function(){r.style.display="none",r.innerHTML=""}),p.appendChild(h),a.appendChild(p);var g=document.createElement("div");g.classList.add("gold-total"),g.classList.add("gold-bottom"),g.innerHTML='<img src="img/loot/gold-5.gif" alt="Gold Total"><span></span>',r.appendChild(g);for(var f=document.querySelectorAll(".gold-total span"),i=0;i<f.length;i++)f[i].parentElement.style.display="flex",f[i].innerHTML=options.gold.toLocaleString()}function startGame(){fadeOut(),setTimeout(function(){resetAll(buildMap),document.querySelector(".flipper").style.transform="rotateY(0deg)",document.querySelector(".flip-container").style.display="none",document.getElementById("tutorial").style.display="none"},1e3)}function resetAll(e){map=null,enemies=null,numberOfEnemies=0,totalWeight=0,hero.canMove=!1,hero.timer=100,timeBar.style.width="100%",timeBar.style.display="flex",timeBar.classList.contains("time-danger")&&timeBar.classList.remove("time-danger"),keyboardPlayer=!1,hero.challengeMode=!1,hero.bossLevel=!1,hero.bossHasSpawned=!1,hero.bossIsDead=!1,optionsPosition="closed",document.getElementById("options-menu").style.transform="translateX(-100%)";var t=document.querySelector(".flip-container");t.style.display="flex";var o=document.getElementById("game-over");o.style.display="none",o.style.opacity="0",e(addHero)}function fadeOut(){var e=document.getElementById("fade-to-black");e.style.display="flex",e.style.animation="fade-out 1s 1 forwards"}function fadeIn(){var e=document.getElementById("fade-to-black");e.style.animation="fade-in 1s 1 forwards";var t=document.getElementById("warning");if(t.src="img/gui/save.svg",t.style.animation="saving 3s 1s 1",setTimeout(function(){e.style.display="none",healthBar.style.transition=".5s",xpBar.style.transition=".5s"},950),hero.bossLevel){var o=document.getElementById("level-splash");o.style.opacity="0",o.style.display="flex",o.innerHTML="<div><h5>- BOSS LEVEL -</h5></div>",o.style.animation="warning 2.5s 1s 1 forwards",setTimeout(function(){o.style.display="none"},3500)}}function buildMap(e){hero.gameLevel%8===0&&(hero.challengeMode=!0),hero.gameLevel%6===0&&(hero.bossLevel=!0),levelContainer.innerHTML="",levelContainer.appendChild(heroContainer),map=[],enemies=[],tilesetNumber=randomNumber(1,tilesets),tilesetInside=randomNumber(1,tilesets),(options.tutorial&&options.newgame||options.endgame)&&(tilesetNumber=tutorialData.tilesetOutside,tilesetInside=tutorialData.tilesetInside);for(var t=1;t<=numberOfRows;t++){for(var o=[],r="r"+t,a=1;a<=numberOfColumns;a++){var n="c"+a,i=r+n;i=new Cell(i,t,a,"empty"),o.push(i)}map.push(o)}var l=randomCell();options.tutorial&&options.newgame&&(l=tutorialData.exitLocation),map[l[0]][l[1]].tile="exit",map[l[0]][l[1]].contents="exit",exit=map[l[0]][l[1]],e()}function addHero(){hero.health||(hero=new Cell("r1c1",1,1,"hero"),hero.armorRating=1,hero.ascending=[],hero.attackRating=1,hero.attacksEvaded=0,hero.avatar=avatarSelection,hero.baseDamage=heroBaseDamage,hero.bosses=["Spider Queen","Vampire Lord","Red Knight"],hero.bossHasSpawned=!1,hero.bossIsDead=!1,hero.bossLevel=!1,hero.canCapture=!0,hero.canMove=!0,hero.challengeMode=!1,hero.cooldownTimer=200,hero.cooldownAttackTimer=500,hero.dexterity=1,hero.difficultyMath=document.querySelector('input[name="mathradio"]:checked').value,hero.difficultyMonster=document.querySelector('input[name="monsterradio"]:checked').value,hero.endurance=1,hero.equalsRight=0,hero.equalsWrong=0,hero.enemiesSlain=0,hero.evasion=10,hero.factorsRight=0,hero.factorsWrong=0,hero.fastTravel=!1,hero.frozen=!1,hero.gameLevel=1,hero.selectedGameModes=gameMode,hero.health=100,hero.hero=!0,hero.id="hero-container",hero.knights=[{number:0,color:"#888888"},{number:2,color:"#cc3234"},{number:3,color:"#1cba4c"},{number:4,color:"#7c629c"},{number:5,color:"#fc8a04"},{number:6,color:"#cccacc"},{number:7,color:"#ffffff"},{number:8,color:"#f4fe04"},{number:9,color:"#a47644"}],hero.lastLocation=map[hero.row-1][hero.col-1],hero.left=0,hero.level=1,hero.location="r"+hero.row+"c"+hero.col,hero.multiplesRight=0,hero.multiplesWrong=0,hero.name=document.getElementById("name-input").value,hero.pause=!1,hero.primesRight=0,hero.primesWrong=0,hero.squaresMoved=0,hero.strength=1,hero.timer=100,hero.timesFrozen=0,hero.timesPoisoned=0,hero.timesWebbed=0,hero.top=0,hero.trapsEvaded=0,hero.xp=0),options.tutorial&&options.newgame&&(hero.top=tutorialData.heroTop,hero.left=tutorialData.heroLeft,hero.row=tutorialData.heroRow,hero.col=tutorialData.heroCol,hero.location=tutorialData.heroLocation),heroContainer.style.width=3*cellSize+"px",heroContainer.style.height=3*cellSize+"px",heroContainer.style.top="-"+cellSize+"px",heroContainer.style.left="-"+cellSize+"px",heroContainer.style.zIndex=15;for(var e=document.querySelectorAll("#hero-container div"),t=0;t<e.length;t++)e[t].style.width=cellSize+"px",e[t].style.height=cellSize+"px";var o=document.querySelector("#hero img");o.src="img/avatars/"+hero.avatar+".gif";var r=document.getElementById("player-name");r.innerHTML="Ser "+hero.name;var a=document.getElementById("level");if(a.innerHTML="Floor "+hero.gameLevel,healthBar.style.width=hero.health+"%",healthBar.style.transition="0s",timeBar.style.transition="0s",(hero.challengeMode||hero.bossLevel||options.tutorial||options.endgame)&&(timeBar.style.display="none"),xpBar.style.width=hero.xp+"%",xpBar.style.transition="0s",heroContainer.style.transform="translate("+hero.left+"px, "+hero.top+"px)",hero.canMove=!0,hero.canCapture=!0,options.tutorial===!1&&options.endgame===!1)var n=hero.squaresMoved,i=0,l=setInterval(function(){(hero.squaresMoved>n||i>=10)&&(clearInterval(l),letTheGamesBegin()),i++},1e3);for(var s=shuffle(rescueText),t=0;t<hero.knights.length;t++)hero.knights[t].rescueText=s[t];getObjectLocations()}function Cell(e,t,o,r){this.location=e,this.row=t,this.col=o,this.tile=r,this.contents="empty",this.hero=!1,this.enemy=[]}function getObjectLocations(){debrisToBuild=randomNumber(3,5),columnsToBuild=randomNumber(1,3),trapsToBuild=[randomNumber(2,4),randomNumber(5,6),randomNumber(7,8)];var e=trapsToBuild[hero.difficultyMonster-1]+debrisToBuild+columnsToBuild;options.endgame&&(e=20);var t=[];locationArray=[];for(var o=0;o<numberOfRows;o++)for(var r=0;r<numberOfColumns;r++){var a=map[o][r];if(a.location!==hero.location&&"exit"!==a.contents&&"blocked"!==a.contents){var n=[a.row-1,a.col-1];t.push(n)}}for(var i=0;i<2*e;i++){var l=randomNumber(0,t.length-1),a=t[l];locationArray.push(a),t.splice(l,1)}randomizeDebris()}function randomCell(){var e=randomNumber(0,numberOfRows-1),t=randomNumber(0,numberOfColumns-1),o=map[e][t];return o.location!==hero.location&&"exit"!==o.contents&&"blocked"!==o.contents?[e,t]:void randomCell()}function randomizeDebris(){var e=themes[randomNumber(0,themes.length-1)];if(options.tutorial&&options.newgame){var t=tutorialData.numDebris;e=tutorialData.objectTheme;var o=[[0,0],[numberOfRows-1,numberOfColumns-1]]}else if(options.endgame)var t=10;else var t=debrisToBuild;for(var r=0;r<t;r++){var a=locationArray[0],n=map[a[0]][a[1]];options.tutorial&&options.newgame&&(n=map[o[r][0]][o[r][1]]),options.endgame?n.object="knight-"+r:n.object=e[randomNumber(0,e.length-1)],n.tile="empty",n.contents="blocked",n.health=30,n.evasion=0,locationArray.shift()}randomizeColumns()}function randomizeColumns(){if(columnArray=[],wallTileset=randomNumber(1,walls),options.endgame||options.tutorial&&options.newgame){var e=tutorialData.numColumns;wallTileset=tutorialData.wallTileset;var t=tutorialData.wallLocation}else if(hero.bossLevel!==!1){wallTileset="0";var e=3}else var e=columnsToBuild;for(var o=0;o<e;o++){var r=locationArray[0],a=map[r[0]][r[1]];(options.endgame||options.tutorial&&options.newgame)&&(a=map[t[o][0]][t[o][1]]),columnArray.push({location:a.location,row:a.row,col:a.col}),a.object="wall",a.cage=!1,a.tile="empty",a.contents="blocked",hero.bossLevel===!1&&(a.health=150,a.evasion=0),locationArray.shift()}randomizeTraps()}function randomizeTraps(){if(trapArray=[],options.tutorial&&options.newgame)var e=tutorialData.numTraps,t=tutorialData.trapLocation;else if(options.endgame)var e=0;else var e=trapsToBuild[hero.difficultyMonster-1];for(var o=0,r=0;r<e;r++){var a=locationArray[0];if(o>25)break;if(void 0===a)r--,o++;else{var n=map[a[0]][a[1]];options.tutorial&&options.newgame&&(n=map[t[r][0]][t[r][1]]),n.tile="empty",n.object=traps[randomNumber(0,traps.length-1)],options.tutorial&&options.newgame&&(n.object=traps[r]),n.contents="trap",n.trapDamage=damageFromTraps,trapArray.push(n),locationArray.shift()}}buildGrid()}function buildGrid(){levelTemplates=["single","dual","corners","tri-corners"],template=levelTemplates[randomNumber(0,levelTemplates.length-1)],wallTorches=randomNumber(0,1),(options.tutorial&&options.newgame||options.endgame)&&(template="corners",wallTorches=1),captive=0,exitTileset="";for(var e=0;e<numberOfRows;e++)buildRow(e);document.querySelector("#level-container .row").id="shadow-top",levelExit=document.getElementById(exit.location),levelExit.style.backgroundImage='url("img/exit.gif")',levelExit.style.overflow="hidden";var t=document.createElement("img");t.src=exitTileset,t.style.width="100%",t.style.height="100%",levelExit.appendChild(t),columnPositions=[];for(var e=0;e<columnArray.length;e++){var o=document.getElementById(columnArray[e].location).getBoundingClientRect();columnPositions.push(o)}options.endgame?theEnd():addMath()}function buildRow(e){var t=document.createElement("div");t.classList.add("row");for(var o=0;o<numberOfColumns;o++){var r=document.createElement("div");r.classList.add("cell"),r.style.width=cellSize+"px",r.style.height=cellSize+"px",r.id=map[e][o].location;var a=applyTileset(map[e][o]);if(r.style.backgroundImage=a,map[e][o].object){var n=document.createElement("img");if(n.src="img/objects/"+map[e][o].object+".gif","wall"===map[e][o].object){if(hero.bossLevel){wallTorches=0;var i=document.createElement("img");i.src="img/objects/knight-"+hero.knights[captive].number+".gif",i.classList.add("prisoner"),r.appendChild(i),captive++}else 1===wallTorches&&r.classList.add("torch");n.src="img/objects/wall-"+wallTileset+".gif",n.className="wall"}else map[e][o].object.includes("knight")&&(n.className="knight");r.appendChild(n)}r.addEventListener("click",fastTravel),t.appendChild(r)}levelContainer.appendChild(t)}function applyTileset(e){var t=e.tile;if("empty"===t||"exit"===t){if("single"===template)var o="img/tiles/"+tilesetNumber+"/empty"+randomNumber(1,empty)+".gif";else if("dual"===template)if(1===e.row||e.row===numberOfRows||1===e.col||e.col===numberOfColumns)var o="img/tiles/"+tilesetInside+"/empty"+randomNumber(1,empty)+".gif";else var o="img/tiles/"+tilesetNumber+"/empty"+randomNumber(1,empty)+".gif";else if("corners"===template)if(1===e.row||e.row===numberOfRows)if(1===e.col||e.col===numberOfColumns)var o="img/tiles/"+tilesetInside+"/empty"+randomNumber(1,empty)+".gif";else var o="img/tiles/"+tilesetNumber+"/empty"+randomNumber(1,empty)+".gif";else if(1===e.col||e.col===numberOfColumns)var o="img/tiles/"+tilesetNumber+"/empty"+randomNumber(1,empty)+".gif";else var o="img/tiles/"+tilesetInside+"/empty"+randomNumber(1,empty)+".gif";else if("tri-corners"===template)if(1===e.row||e.row===numberOfRows)if(1===e.col||2===e.col||e.col===numberOfColumns||e.col===numberOfColumns-1)var o="img/tiles/"+tilesetNumber+"/empty"+randomNumber(1,empty)+".gif";else var o="img/tiles/"+tilesetInside+"/empty"+randomNumber(1,empty)+".gif";else if(2===e.row||e.row===numberOfRows-1)if(1===e.col||e.col===numberOfColumns)var o="img/tiles/"+tilesetNumber+"/empty"+randomNumber(1,empty)+".gif";else var o="img/tiles/"+tilesetInside+"/empty"+randomNumber(1,empty)+".gif";else var o="img/tiles/"+tilesetInside+"/empty"+randomNumber(1,empty)+".gif"}else var o='url("img/'+t+'.gif")';return"exit"===e.contents?exitTileset=o:o='url("'+o+'")',o}function handleTraps(){for(var e=0;e<trapArray.length;e++)"fire-grate"===trapArray[e].object&&!function(){var t=hero.gameLevel,o=map[trapArray[e].row-1][trapArray[e].col-1];o.contents="empty";var r=randomNumber(5e3,1e4),a=document.querySelector("#"+trapArray[e].location+" img"),n=setInterval(function(){t===hero.gameLevel?(a.src="img/objects/fire-grate-on.gif",o.contents="trap",o.location===hero.location&&checkForTraps(),setTimeout(function(){a.src="img/objects/fire-grate.gif",o.contents="empty"},3e3)):clearInterval(n)},r)}()}function addMath(){if(hero.bossLevel){var e=hero.selectedGameModes[randomNumber(0,hero.selectedGameModes.length-1)];hero.bossLevel=hero.bosses[randomNumber(0,hero.bosses.length-1)]}if(hero.challengeMode)var e=challengeMode[randomNumber(0,challengeMode.length-1)];else if(options.tutorial&&options.newgame){var e=tutorialData.gameMode;document.querySelector("#top-bar .btn-options").style.pointerEvents="none",document.getElementById("top-bar").style.opacity=0,document.getElementById("healthbar").style.opacity=0,document.getElementById("xpbar").style.opacity=0}else var e=hero.selectedGameModes[randomNumber(0,hero.selectedGameModes.length-1)];hero.gameMode=e,hero.answers=0,hero.answersNeeded=0;for(var t=0,o=0,r=0,a=0;a<numberOfRows;a++)for(var n=0;n<numberOfColumns;n++)"empty"===map[a][n].contents&&t++;t++,o=Math.ceil(t*(randomNumber(correctMinThreshold,correctMaxThreshold)/100)),r=t-o,hero.answersNeeded=o,"multiples"===e?multiples(t,o,r,displayMath):"factors"===e?factors(t,o,r,displayMath):"primes"===e?primes(t,o,r,displayMath):"equality"===e?equality(t,o,r,displayMath):"ascending"!==e&&"descending"!==e||ascendingDescending(t,displayMath)}function multiples(e,t,o,r){var a=[{min:2,max:10,highest:50},{min:5,max:25,highest:100},{min:10,max:50,highest:200}];target=randomNumber(a[hero.difficultyMath-1].min,a[hero.difficultyMath-1].max),options.tutorial&&options.newgame&&(target=tutorialData.target);for(var n=[],i=[],l=a[hero.difficultyMath-1].highest,s=Math.floor(l/target),m=0,c=0,d=0;d<e;d++)n.length<t?(answer={number:randomNumber(1,s)*target,answer:!0},answer.number%target===0&&n.push(answer),m++):i.length<o&&(answer={number:randomNumber(2,l),answer:!1},answer.number%target!==0?i.push(answer):(answer.number--,answer.number%target!==0?i.push(answer):d--),c++);var h=n.concat(i);h=shuffle(h),document.getElementById("game-mode").innerHTML="Multiples of "+target,r(h,fadeIn)}function factors(e,t,o,r){var a=[{min:20,max:40},{min:40,max:100},{min:50,max:200}];target=randomNumber(a[hero.difficultyMath-1].min,a[hero.difficultyMath-1].max);for(var n=[],i=[],l=[],s=[],m=0,c=1;c<=target;c++)target%c===0?n.push(c):i.push(c);for(var c=0;c<e;c++)l.length<t?(answer={number:n[randomNumber(0,n.length-1)],answer:!0},l.push(answer)):s.length<o&&(answer={number:i[randomNumber(0,i.length-1)],answer:!1},s.push(answer)),m++;var d=l.concat(s);d=shuffle(d),document.getElementById("game-mode").innerHTML="Factors of "+target,r(d,fadeIn)}function primes(e,t,o,r){var a=[{max:50},{max:100},{max:200}],n=[],i=[];generatePrimeNumbers(a[hero.difficultyMath-1].max);for(var l=0,s=0;s<e;s++)answer={number:nonPrimes[randomNumber(0,nonPrimes.length-1)],answer:!1},n.length<t?(answer={number:primeNumbers[randomNumber(0,primeNumbers.length-1)],answer:!0},n.push(answer)):i.length<o?(answer={number:nonPrimes[randomNumber(0,nonPrimes.length-1)],answer:!1},i.push(answer)):s--,l++;var m=n.concat(i);m=shuffle(m),document.getElementById("game-mode").innerHTML="Prime Numbers",r(m,fadeIn)}function generatePrimeNumbers(e){var t=[];primeNumbers=[],nonPrimes=[];for(var o=2;o<=e;o++)t.push(o);for(;t.length;)primeNumbers.push(t.shift()),t=t.filter(function(e){return e%primeNumbers[primeNumbers.length-1]===0&&nonPrimes.push(e),e%primeNumbers[primeNumbers.length-1]!=0})}function equality(e,t,o,r){var a=[{min:4,max:15,highest:25,deviation:10},{min:15,max:50,highest:75,deviation:10},{min:50,max:100,highest:150,deviation:10}];target=randomNumber(a[hero.difficultyMath-1].min,a[hero.difficultyMath-1].max);for(var n=[],i=[],l=[],s=[],m=[],c=[],d=["+","-","*","/"],h=a[hero.difficultyMath-1].highest,u=a[hero.difficultyMath-1].deviation,p=1;p<=target;p++)target%p===0?l.push(p):s.push(p);for(var p=1;p<=h;p++)p%target===0?m.push(p):c.push(p);for(var p=0;p<e;p++){var g="",f=d[randomNumber(0,d.length-1)],v=randomNumber(1,target);if("+"===f){if(n.length<t){var y=target-v;g=v+f+y,answer={number:g,answer:!0},n.push(answer)}else if(i.length<o){var y=target-v;y+=randomNumber(1,u),g=v+f+y,answer={number:g,answer:!1},i.push(answer)}}else if("-"===f){if(n.length<t){var y=target+v;g=y+f+v,answer={number:g,answer:!0},n.push(answer)}else if(i.length<o){var y=target+v;y+=randomNumber(1,u),g=y+f+v,answer={number:g,answer:!1},i.push(answer)}}else if("*"===f){if(n.length<t){var v=l[randomNumber(0,l.length-1)],y=target/v;g=v+"&times;"+y,answer={number:g,answer:!0},n.push(answer)}else if(i.length<o){var v=s[randomNumber(0,s.length-1)],y=randomNumber(1,u);g=v+"&times;"+y,answer={number:g,answer:!1},i.push(answer)}}else if("/"===f)if(n.length<t){var v=m[randomNumber(0,m.length-1)],y=v/target;g=v+"&divide;"+y,answer={number:g,answer:!0},n.push(answer)}else if(i.length<o){var v=c[randomNumber(0,c.length-1)],y=randomNumber(1,u);g=v+"&divide;"+y,answer={number:g,answer:!1},i.push(answer)}}var b=n.concat(i);b=shuffle(b),document.getElementById("game-mode").innerHTML="Equals "+target,r(b,fadeIn)}function ascendingDescending(e,t){for(var o=[{min:1,max:totalCells},{min:1,max:2*totalCells},{min:1,max:4*totalCells}],r=[],a=[],n=0;n<e;n++){var i=randomNumber(o[hero.difficultyMath-1].min,o[hero.difficultyMath-1].max);a.indexOf(i)==-1?(answer={number:i,answer:!0},r.push(answer),a.push(i)):n--}if("ascending"===hero.gameMode){a.sort(function(e,t){return e-t});var l="Ascending Order"}else if("descending"===hero.gameMode){a.sort(function(e,t){return t-e});var l="Descending Order"}hero.ascending=a,hero.answersNeeded=e,document.getElementById("game-mode").innerHTML=l,t(r,fadeIn)}function shuffle(e){for(var t,o,r=e.length;0!==r;)o=Math.floor(Math.random()*r),r-=1,t=e[r],e[r]=e[o],e[o]=t;return e}function displayMath(e,t){for(var o=0,r=0,a=0;a<numberOfRows;a++)for(var n=0;n<numberOfColumns;n++)if("empty"===map[a][n].contents||"exit"===map[a][n].contents){
map[a][n].number=e[o].number,map[a][n].answer=e[o].answer;var i=document.getElementById(map[a][n].location),l=document.createElement("p");if(l.style.fontSize=cellFontSize,options.tutorial&&options.newgame&&(l.style.opacity="0"),l.innerHTML=e[o].number,null!==i)i.appendChild(l),o++;else{if(r>100)break;r++}}t(),handleTraps(),options.tutorial&&startTutorial()}function openExitCover(){if(hero.answers>=hero.answersNeeded&&options.tutorial===!1){var e=document.querySelector("#"+levelExit.id+" p");null!==e&&(e.style.opacity="0"),setTimeout(function(){var e=document.querySelector("#"+levelExit.id+" img");e.style.transition="2.25s ease-in-out",e.style.transform="translateY(-100%)",document.getElementById("game-mode").innerHTML="Level Complete!"},1500);for(var t=document.querySelectorAll(".cell p"),o=0;o<t.length;o++)t[o].style.opacity="0",hero.canCapture=!1}}function checkMath(){var e=!1,t=map[hero.row-1][hero.col-1];if("captured"!==t.answer&&hero.canCapture!==!1&&t.hasOwnProperty("answer"))if(t.number===hero.ascending[0]?(e=!0,t.answer="captured",hero.ascending.shift()):t.answer&&hero.challengeMode===!1&&(e=!0),e){hero.timer+timeRestoreFromCapture<100?hero.timer+=timeRestoreFromCapture:hero.timer=100,hero.answers++,restoreHealth(healthRestoreFromCapture),t.answer="captured";var o=document.querySelector("#"+t.location+" p");setTimeout(function(){null===o||o.remove()},250),hero.answers===hero.answersNeeded&&(hero.bossLevel&&hero.bossIsDead?openExitCover():hero.bossLevel===!1&&openExitCover()),"multiples"===hero.gameMode?hero.multiplesRight++:"factors"===hero.gameMode?hero.factorsRight++:"primes"===hero.gameMode?hero.primesRight++:"equality"===hero.gameMode&&hero.equalsRight++;var r=document.createElement("span");r.classList.add("flash"),o.parentElement.appendChild(r),setTimeout(function(){r.remove()},600)}else if(t.hasOwnProperty("answer")){"multiples"===hero.gameMode?hero.multiplesWrong++:"factors"===hero.gameMode?hero.factorsWrong++:"primes"===hero.gameMode?hero.primesWrong++:"equality"===hero.gameMode&&hero.equalsWrong++,hero.timer-=timeLostFromWrongAnswer,dealDamage(damageFromWrongAnswer,"wrong answer");var o=document.querySelector("#"+t.location+" p"),r=document.createElement("span");r.classList.add("flash-wrong"),o.parentElement.appendChild(r),setTimeout(function(){r.remove()},600)}else;}function letTheGamesBegin(){var e=500,t=e/1e3;timeBar.style.transition=t+"s linear";var o=100/defaultTimer*(e/1e3),r=hero.gameLevel,a=30,e=setInterval(function(){hero.timer<=a?timeBar.classList.contains("time-danger")||timeBar.classList.add("time-danger"):hero.timer>a&&timeBar.classList.remove("time-danger"),hero.pause||(r!==hero.gameLevel||null===map||null===hero||hero.bossLevel||hero.challengeMode||options.tutorial||options.endgame?clearInterval(e):hero.answers>=hero.answersNeeded?clearInterval(e):(hero.timer-=o,hero.timer<=0?(clearInterval(e),dealDamage(1e6,"time")):timeBar.style.width=hero.timer+"%"))},e);1==hero.difficultyMonster?(maxWeight=50,maxEnemies=5):2==hero.difficultyMonster?(maxWeight=100,maxEnemies=10):3==hero.difficultyMonster&&(maxWeight=200,maxEnemies=15),levelData={redKnight:!1,blueKnight:!1,yellowKnight:!1},maxWeight+=10*(hero.level-1),hero.level%2===0&&(maxEnemies+=hero.level/2),hero.bossLevel!==!1&&(maxWeight*=2,maxEnemies=25),spawnArray=[];try{for(var n=0;n<numberOfRows;n++)for(var i=0;i<numberOfColumns;i++){var l=map[n][i];0===n||n===numberOfRows-1?l.object&&"trap"!==l.contents||spawnArray.push(l):0!==i&&i!==numberOfColumns-1||l.object&&"trap"!==l.contents||spawnArray.push(l)}var s=spawnArray[randomNumber(0,spawnArray.length-1)];getEnemy(s.row,s.col)}catch(m){}options.tutorial===!1&&spawnEnemy()}function spawnEnemy(){var e=hero.gameLevel,t=randomNumber(1e3,3e3),o=setInterval(function(){if(null===map||0===map.length||hero.bossIsDead||e!==hero.gameLevel)clearInterval(o);else if(totalWeight<maxWeight&&numberOfEnemies<maxEnemies){var t=spawnArray[randomNumber(0,spawnArray.length-1)];getEnemy(t.row,t.col)}else numberOfEnemies>=maxEnemies&&clearInterval(o)},t)}function getEnemy(e,t){var o=bestiary[randomNumber(0,bestiary.length-1)];"Spider Queen"===hero.bossLevel?(hero.bossHasSpawned===!1?(o=bosses[0],hero.bossHasSpawned=!0):o=bestiary[2],addEnemy(e,t,o)):"Vampire Lord"===hero.bossLevel?(hero.bossHasSpawned===!1?(o=bosses[1],hero.bossHasSpawned=!0):o=bestiary[0],addEnemy(e,t,o)):"Red Knight"===hero.bossLevel?(maxEnemies=3,maxWeight=1e3,"Red Knight"===hero.bossLevel&&levelData.redKnight===!1?(o=bosses[2],hero.bossHasSpawned=!0,levelData.redKnight="alive"):"Red Knight"===hero.bossLevel&&(levelData.blueKnight===!1?(o=bosses[3],levelData.blueKnight="alive"):levelData.yellowKnight===!1&&(o=bosses[4],levelData.yellowKnight="alive")),addEnemy(e,t,o)):options.tutorial&&options.newgame?(o=bestiary[1],addEnemy(3,1,o)):o.weight+totalWeight<=maxWeight&&addEnemy(e,t,o)}function enemyWarning(){var e=document.getElementById("warning");e.src="img/gui/warning.svg",e.style.animation="warning 2.5s 1",setTimeout(function(){e.style.animation=""},2500)}function addEnemy(e,t,o){function r(){var e=setInterval(function(){if(keyboardPlayer&&!a.boss&&(a.attackRating=keyboardDamageModifier),a.gameLevel!==hero.gameLevel)clearTimeout(e),a=null,delete a;else if(null===map||null===hero)clearTimeout(e),a=null,delete a;else if(hero.bossHasSpawned&&hero.bossIsDead&&a.health>0)a.evasion=0,a.health=1,checkForAttack("none",a,hero);else if(a.health<=0){if(a.boss){if("Red Knight"===a.type?levelData.redKnight="dead":"Blue Knight"===a.type?levelData.blueKnight="dead":"Yellow Knight"===a.type&&(levelData.yellowKnight="dead"),"dead"===levelData.redKnight&&"dead"===levelData.blueKnight&&"dead"===levelData.yellowKnight){hero.bossIsDead=!0;var t=hero.bosses.indexOf("Red Knight");hero.bosses.splice(t,1)}else if("Red Knight"!==a.type&&"Blue Knight"!==a.type&&"Yellow Knight"!==a.type){hero.bossIsDead=!0;var t=hero.bosses.indexOf(a.type);hero.bosses.splice(t,1)}hero.bossIsDead&&setTimeout(function(){for(var e=0;e<columnArray.length;e++){var t=document.getElementById(columnArray[e].location).lastChild;t.style.opacity="0";var o=columnArray[e];map[o.row-1][o.col-1].contents="empty"}textBubble("rescue",1e3),hero.answers===hero.answersNeeded&&openExitCover()},2e3)}clearTimeout(e),awardXp(a),totalWeight-=a.weight,hero.enemiesSlain++,a=null,delete a,delete m}else if(hero.pause===!0);else if(a.health>=0)if(a.abilities){var o=randomNumber(1,100);if(a.currentAbility=a.abilities[randomNumber(0,a.abilities.length-1)],o<=a.currentAbility.abilityChance)if("acid"===a.currentAbility.ability||"web"===a.currentAbility.ability||"poison"===a.currentAbility.ability||"ice"===a.currentAbility.ability)layTrap(a);else if("rotate"===a.currentAbility.ability)rotateEquation(a);else if("projectile"===a.currentAbility.ability)enemyProjectile(a,m);else if("burst"===a.currentAbility.ability&&0===a.currentAbility.shots)var r=setInterval(function(){a.cooldown?clearInterval(r):a.currentAbility.shots>=3?(a.currentAbility.shots=0,clearInterval(r),cooldown(a,a.moveInterval)):a.cooldown===!1&&(enemyProjectile(a,m),a.currentAbility.shots++)},a.currentAbility.burstSpeed);else"invisibility"===a.currentAbility.ability&&a.invisible===!1&&turnInvisible(a,m);getMovementDirection(a,m)}else getMovementDirection(a,m);else clearTimeout(r),totalWeight=0,a=null,delete a,delete m},a.moveInterval)}enemyWarning(),numberOfEnemies++;var a=JSON.parse(JSON.stringify(o));if(totalWeight+=a.weight,a.armorRating=1,a.attackRating=1,a.canMove=!0,a.col=t,a.cooldown=!1,a.enemy=!0,a.gameLevel=hero.gameLevel,a.id="enemy-container"+numberOfEnemies,a.invisible=!1,a.left=t*cellSize-cellSize,a.location="r"+e+"c"+t,a.row=e,a.startingHealth=o.health,a.top=e*cellSize-cellSize,options.enemiesEncountered.indexOf(a.type)==-1&&(options.enemiesEncountered.unshift(a.type),options.newEnemies++,localStorage.setItem("options",JSON.stringify(options))),null===enemies)return void resetAll();enemies.push(a);var n=document.createElement("div");if(a.boss){2===hero.bosses.length&&(a.startingHealth*=1.25,a.health*=1.25,a.attackRating+=.25),1===hero.bosses.length&&(a.startingHealth*=1.5,a.health*=1.5,a.attackRating+=.5),a.startingHealth*=hero.difficultyMonster,a.health*=hero.difficultyMonster,n.classList.add("boss");var i=document.createElement("span");i.id="boss-health","Red Knight"===a.type?i.id="boss-health-redknight":"Blue Knight"===a.type?i.id="boss-health-blueknight":"Yellow Knight"===a.type&&(i.id="boss-health-yellowknight"),i.style.width="100%",i.style.opacity="0",n.appendChild(i)}else n.classList.add("enemy");"aggressive"===a.moveType&&n.classList.add("flying"),n.id=a.id,n.style.width=cellSize+"px",n.style.height=cellSize+"px",n.style.backgroundImage='url("img/enemies/shadow.png")',n.style.top="0",n.style.left="0",n.style.zIndex=10,n.style.transitionDuration="0";var l=document.createElement("span");l.className="message",l.innerHTML="",n.appendChild(l);var s=document.createElement("img");s.src="img/enemies/"+a.image,n.appendChild(s),levelContainer.appendChild(n);var m=document.getElementById(a.id);m.style.transition=a.moveSpeed+"s ease",1===a.row?m.style.transform="translate("+a.left+"px, -"+cellSize+"px)":a.row===numberOfRows?m.style.transform="translate("+a.left+"px, "+(a.top+cellSize)+"px)":1===a.row&&a.row===numberOfRows||(1===a.col?m.style.transform="translate(-"+cellSize+"px, "+a.top+"px)":a.col===numberOfColumns&&(m.style.transform="translate("+(a.left+cellSize)+"px, "+a.top+"px)")),setTimeout(function(){m.style.transform="translate("+a.left+"px, "+a.top+"px)",null!==map&&map[a.row-1][a.col-1].enemy.push(a.id),r()},2e3)}function damageOverTime(e,t){var o=t.currentAbility.abilityDamge;flashMessage(e,t.currentAbility.dotStatus,t.currentAbility.damageDuration);var r=setInterval(function(){e.health<=0?clearInterval(r):dealDamage(o,t)},250);setTimeout(function(){clearInterval(r)},t.currentAbility.damageDuration)}function turnInvisible(e,t){var o=e.currentAbility.abilityDamge;if(e.invisible=!0,e.evasion=50,t.lastChild.style.opacity="0",e.boss){var r=document.getElementById("boss-health");r.style.opacity="0"}var a=setInterval(function(){e.health<=0?clearInterval(a):e.invisible?Math.abs(hero.row-e.row)<=1&&Math.abs(hero.col-e.col)<=1&&dealDamage(o,e):clearInterval(a)},250);setTimeout(function(){e.invisible=!1,e.evasion=0,t.lastChild.style.opacity="1",e.boss&&(r.style.opacity="1")},e.currentAbility.abilityDuration)}function enemyProjectile(e,t){if(randomNumber(1,100)<e.currentAbility.targetChance){if(e.row===hero.row&&e.col<hero.col)var o="right";else if(e.row===hero.row&&e.col>hero.col)var o="left";else if(e.col===hero.col&&e.row>hero.row)var o="up";else if(e.col===hero.col&&e.row<hero.row)var o="down"}else var r=["up","down","left","right"],o=r[randomNumber(0,3)];var a=(t.getBoundingClientRect(),document.createElement("img")),n=e.currentAbility.abilityImage[randomNumber(0,e.currentAbility.abilityImage.length-1)];a.src="img/enemies/"+n,a.id="projectile"+randomNumber(1,1e3),a.classList.add("projectile"),a.style.width=cellSize+"px",a.style.height=cellSize+"px",a.style.top=e.top+"px",a.style.left=e.left+"px","down"===o?a.style.transform="rotate(180deg)":"left"===o?a.style.transform="rotate(-90deg)":"right"===o&&(a.style.transform="rotate(90deg)"),levelContainer.appendChild(a);var i=document.getElementById(a.id);if("up"===o){var l=levelContainer.clientHeight+cellSize,s=numberOfRows*e.currentAbility.abilityDuration;i.style.transition=s+"s linear",i.style.transform="translateY(-"+l+"px)"}else if("down"===o){var l=levelContainer.clientHeight+cellSize,s=numberOfRows*e.currentAbility.abilityDuration;i.style.transition=s+"s linear",i.style.transform="translateY("+l+"px) rotate(180deg)"}else if("left"===o){var l=levelContainer.clientWidth+cellSize,s=numberOfColumns*e.currentAbility.abilityDuration;i.style.transition=s+"s linear",i.style.transform="translateX(-"+l+"px) rotate(-90deg)"}else if("right"===o){var l=levelContainer.clientWidth+cellSize,s=numberOfColumns*e.currentAbility.abilityDuration;i.style.transition=s+"s linear",i.style.transform="translateX("+l+"px) rotate(90deg)"}var m=!0,c=setInterval(function(){var t=i.getBoundingClientRect(),o=player.getBoundingClientRect();if(Math.abs(t.top-o.top)<=.85*cellSize&&Math.abs(t.left-o.left)<=.85*cellSize&&m)if(randomNumber(1,100)>hero.evasion)n=n.split("-").pop().split(".").shift(),"ice"===n?(freezePerson(hero,e.currentAbility.damageDuration,"ice"),clearInterval(c),i.style.display="none"):"poison"===n?(hero.timesPoisoned++,damageOverTime(hero,e),clearInterval(c),i.style.display="none"):(flashHitImage(hero,player),dealDamage(e.currentAbility.abilityDamge,e),clearInterval(c),i.style.display="none");else{m=!1,flashMessage(hero,"evaded!"),hero.attacksEvaded++;var r=1250*e.currentAbility.abilityDuration;setTimeout(function(){m=!0},r)}for(var a=0;a<columnPositions.length;a++)Math.abs(t.top-columnPositions[a].top)<=.85*cellSize&&Math.abs(t.left-columnPositions[a].left)<=.85*cellSize&&m&&(clearInterval(c),i.style.display="none")},250);setTimeout(function(){clearInterval(c),i.remove()},1e3*s)}function rotateEquation(e){var t=map[e.row-1][e.col-1];if(t.hasOwnProperty("answer")&&"captured"!==t.answer){var o=document.querySelector("#"+e.location+" p");o.style.transition="1s",o.style.transform="rotate(180deg)",o.style.color="#E22727",setTimeout(function(){o.style.transform="rotate(0deg)",o.style.color="#fff"},e.currentAbility.abilityDuration)}}function layTrap(e){var t=map[e.row-1][e.col-1],o=document.getElementById(e.location);if("trap"===t.contents);else if("trap"!==t.contents){var r=t.contents,a=t.trapDamage;t.contents="trap",t.trapType=e.currentAbility.ability,t.trapDamage=e.currentAbility.abilityDamge,"ice"!==e.currentAbility.ability&&"web"!==e.currentAbility.ability||(t.trapDuration=e.currentAbility.trapDuration);var n=document.createElement("img");n.src="img/objects/"+e.currentAbility.ability+"-"+randomNumber(1,2)+".gif",n.opacity="0",n.style.animation="img-fade-in 1s 1",o.appendChild(n),setTimeout(function(){n.style.animation="img-fade-out 1s 1 forwards",t.contents=r,t.trapType="",t.trapDamage=a,setTimeout(function(){n.style.display="none",o.removeChild(n)},1e3)},e.currentAbility.abilityDuration)}}function getMovementDirection(e,t){var o=["up","down","left","right"],r=!1;if("passive"===e.moveType)var a=40;else var a=80;if(1===e.row){var n=o.indexOf("up");o.splice(n,1)}else{var i=map[e.row-2][e.col-1];if(i.hero&&randomNumber(1,100)<=a)checkForAttack("up",hero,e),r=!0;else if("blocked"===i.contents||i.enemy.length>0||i.hero){var n=o.indexOf("up");o.splice(n,1)}}if(e.row===numberOfRows){var n=o.indexOf("down");o.splice(n,1)}else{var i=map[e.row][e.col-1];if(i.hero&&randomNumber(1,100)<=a)checkForAttack("down",hero,e),r=!0;else if("blocked"===i.contents||i.enemy.length>0||i.hero){var n=o.indexOf("down");o.splice(n,1)}}if(1===e.col){var n=o.indexOf("left");o.splice(n,1)}else{var i=map[e.row-1][e.col-2];if(i.hero&&randomNumber(1,100)<=a)checkForAttack("left",hero,e),r=!0;else if("blocked"===i.contents||i.enemy.length>0||i.hero){var n=o.indexOf("left");o.splice(n,1)}}if(e.col===numberOfColumns){var n=o.indexOf("right");o.splice(n,1)}else{var i=map[e.row-1][e.col];if(i.hero&&randomNumber(1,100)<=a)checkForAttack("right",hero,e),r=!0;else if("blocked"===i.contents||i.enemy.length>0||i.hero){var n=o.indexOf("right");o.splice(n,1)}}"passive"===e.moveType&&r===!1?moveEnemy(e,t,o):"aggressive"===e.moveType&&r===!1&&getAggressiveMovement(e,t)}function getAggressiveMovement(e,t){if(e.row===hero.row&&e.col===hero.col);else if(e.row===hero.row){if(e.col!==numberOfColumns){var o=map[e.row-1][e.col];if(e.col<hero.col&&o.hero===!1)var r=["right"]}if(1!==e.col){var o=map[e.row-1][e.col-2];if(e.col>hero.col&&o.hero===!1)var r=["left"]}}else if(e.col===hero.col){if(e.row!==numberOfRows){var o=map[e.row][e.col-1];if(e.row<hero.row&&o.hero===!1)var r=["down"]}if(1!==e.row){var o=map[e.row-2][e.col-1];if(e.row>hero.row&&o.hero===!1)var r=["up"]}}else if(Math.abs(e.row-hero.row)<Math.abs(e.col-hero.col)){if(e.col!==numberOfColumns){var o=map[e.row-1][e.col];if(e.col<hero.col&&o.hero===!1)var r=["right"]}if(1!==e.col){var o=map[e.row-1][e.col-2];if(e.col>hero.col&&o.hero===!1)var r=["left"]}}else{if(e.row!==numberOfRows){var o=map[e.row][e.col-1];if(e.row<hero.row&&o.hero===!1)var r=["down"]}if(1!==e.row){var o=map[e.row-2][e.col-1];if(e.row>hero.row&&o.hero===!1)var r=["up"]}}moveEnemy(e,t,r)}function moveEnemy(e,t,o){if(void 0===o)var r="none";else var r=o[randomNumber(0,o.length-1)];"up"===r?(map[e.row-1][e.col-1].enemy.splice(0,1),e.top-=cellSize,t.style.transform="translate("+e.left+"px, "+e.top+"px)",e.row--,map[e.row-1][e.col-1].enemy.push(e.id)):"down"===r?(map[e.row-1][e.col-1].enemy.splice(0,1),e.top+=cellSize,t.style.transform="translate("+e.left+"px, "+e.top+"px)",e.row++,map[e.row-1][e.col-1].enemy.push(e.id)):"left"===r?(map[e.row-1][e.col-1].enemy.splice(0,1),e.left-=cellSize,t.style.transform="translate("+e.left+"px, "+e.top+"px)",e.col--,map[e.row-1][e.col-1].enemy.push(e.id)):"right"===r&&(map[e.row-1][e.col-1].enemy.splice(0,1),e.left+=cellSize,t.style.transform="translate("+e.left+"px, "+e.top+"px)",e.col++,map[e.row-1][e.col-1].enemy.push(e.id)),e.location="r"+e.row+"c"+e.col}function checkKey(e){if(hero.canMove){e=e||window.event;var t=!1;"37"==e.keyCode||"65"==e.keyCode?(t="move-left",keyboardPlayer=!0):"38"==e.keyCode||"87"==e.keyCode?(t="move-up",keyboardPlayer=!0):"39"==e.keyCode||"68"==e.keyCode?(t="move-right",keyboardPlayer=!0):"40"==e.keyCode||"83"==e.keyCode?(t="move-down",keyboardPlayer=!0):"32"==e.keyCode&&(hero.fastTravel=!1,checkMath()),t!==!1&&(hero.fastTravel=!1,moveHero(t))}}function fastTravel(e){if(hero.fastTravel)hero.fastTravel=!1;else for(var t,o=0;o<numberOfRows;o++)for(var r=0;r<numberOfColumns;r++)if(map[o][r].location===e.target.id&&"blocked"!==map[o][r].contents){t=map[o][r],hero.fastTravel=t;var a=document.createElement("span");if(a.classList.add("highlight"),document.getElementById(t.location).appendChild(a),a.style.borderColor="rgba(12,126,180,1)",hero.fastTravel!==!1&&hero.canMove!==!1){hero.fastTravel;fastTravelPathing(a)}var n=setInterval(function(){if(hero.fastTravel!==!1&&hero.canMove!==!1){hero.fastTravel;fastTravelPathing(a)}else clearInterval(n),a.style.borderColor="rgba(0,0,0,0)",setTimeout(function(){a.remove()},500)},500)}}function fastTravelPathing(e){var t=hero.fastTravel,o=Math.abs(hero.row-t.row),r=Math.abs(hero.col-t.col);if(o>r)var a="vertical";else var a="horizontal";Math.abs(hero.row-t.row)<=1&&Math.abs(hero.col-t.col)<=1&&setTimeout(function(){e.style.borderColor="rgba(0,0,0,0)"},350),hero.location===t.location?hero.fastTravel=!1:hero.row===t.row?hero.col>t.col?"blocked"!==map[hero.row-1][hero.col-2].contents&&0===map[hero.row-1][hero.col-2].enemy.length?moveHero("move-left"):hero.row!==numberOfRows&&"blocked"!==map[hero.row][hero.col-1].contents&&0===map[hero.row][hero.col-1].enemy.length?moveHero("move-down"===hero.lastLocation.lastMove?"move-down":"move-up"):hero.row===numberOfRows&&"blocked"!==map[hero.row-2][hero.col-1].contents&&0===map[hero.row-2][hero.col-1].enemy.length?moveHero("move-up"===hero.lastLocation.lastMove?"move-up":"move-down"):hero.fastTravel=!1:hero.col<t.col&&("blocked"!==map[hero.row-1][hero.col].contents&&0===map[hero.row-1][hero.col].enemy.length?moveHero("move-right"):hero.row!==numberOfRows&&"blocked"!==map[hero.row][hero.col-1].contents&&0===map[hero.row][hero.col-1].enemy.length?moveHero("move-down"===hero.lastLocation.lastMove?"move-down":"move-up"):hero.row===numberOfRows&&"blocked"!==map[hero.row-2][hero.col-1].contents&&0===map[hero.row-1][hero.col-2].enemy.length?moveHero("move-up"===hero.lastLocation.lastMove?"move-up":"move-down"):hero.fastTravel=!1):hero.row>t.row&&"vertical"===a?"blocked"!==map[hero.row-2][hero.col-1].contents&&0===map[hero.row-2][hero.col-1].enemy.length?moveHero("move-up"):hero.col!==numberOfColumns&&"blocked"!==map[hero.row-1][hero.col].contents&&0===map[hero.row-1][hero.col].enemy.length?moveHero("move-right"===hero.lastLocation.lastMove?"move-right":"move-left"):hero.col===numberOfColumns&&"blocked"!==map[hero.row-1][hero.col-2].contents&&0===map[hero.row-1][hero.col-2].enemy.length?moveHero("move-left"===hero.lastLocation.lastMove?"move-left":"move-right"):hero.fastTravel=!1:hero.row<t.row&&"vertical"===a?"blocked"!==map[hero.row][hero.col-1].contents&&0===map[hero.row][hero.col-1].enemy.length?moveHero("move-down"):hero.col>t.col||hero.col===numberOfColumns&&"blocked"!==map[hero.row-1][hero.col-2].contents&&0===map[hero.row-1][hero.col-2].enemy.length?moveHero("move-left"===hero.lastLocation.lastMove?"move-left":"move-right"):hero.col!==numberOfColumns&&"blocked"!==map[hero.row-1][hero.col].contents&&0===map[hero.row-1][hero.col].enemy.length?moveHero("move-right"===hero.lastLocation.lastMove?"move-right":"move-left"):hero.fastTravel=!1:hero.col>t.col&&"horizontal"===a?"blocked"!==map[hero.row-1][hero.col-2].contents&&0===map[hero.row-1][hero.col-2].enemy.length?moveHero("move-left"):hero.row<t.row&&"blocked"!==map[hero.row][hero.col-1].contents&&0===map[hero.row][hero.col-1].enemy.length?moveHero("move-down"===hero.lastLocation.lastMove?"move-down":"move-up"):hero.row>t.row&&"blocked"!==map[hero.row-2][hero.col-1].contents&&0===map[hero.row-2][hero.col-1].enemy.length?moveHero("move-up"===hero.lastLocation.lastMove?"move-up":"move-down"):hero.fastTravel=!1:hero.col<t.col&&"horizontal"===a?"blocked"!==map[hero.row-1][hero.col].contents&&0===map[hero.row-1][hero.col].enemy.length?moveHero("move-right"):hero.row<t.row&&"blocked"!==map[hero.row][hero.col-1].contents&&0===map[hero.row][hero.col-1].enemy.length?moveHero("move-down"===hero.lastLocation.lastMove?"move-down":"move-up"):hero.row>t.row&&"blocked"!==map[hero.row-2][hero.col-1].contents&&0===map[hero.row-2][hero.col-1].enemy.length?moveHero("move-up"===hero.lastLocation.lastMove?"move-up":"move-down"):hero.fastTravel=!1:hero.fastTravel=!1}function moveHero(e){if(hero.canMove&&hero.health>0&&null!==hero){var t=map[hero.row-1][hero.col-1];if(hero.lastLocation=t,hero.lastLocation.lastMove=e,"move-up"===e)if(1===hero.row);else{var o=map[hero.row-2][hero.col-1];if(o.enemy.length>0){var r=o.enemy[0],a=enemies.filter(function(e){return e.id===r})[0];checkForAttack("up",a,hero)}else hero.top>=cellSize&&"blocked"!==o.contents?(cooldown(hero,hero.cooldownTimer),map[hero.row-1][hero.col-1].hero=!1,hero.top-=cellSize,heroContainer.style.transform="translate("+hero.left+"px, "+hero.top+"px)",hero.row--,hero.squaresMoved++,map[hero.row-1][hero.col-1].hero=!0,checkForTraps(),checkForLoot()):checkForAttack("up",o,hero)}else if("move-down"===e)if(hero.row===numberOfRows);else{var o=map[hero.row][hero.col-1];if(o.enemy.length>0){var r=o.enemy[0],a=enemies.filter(function(e){return e.id===r})[0];cooldown(hero,hero.cooldownAttackTimer),checkForAttack("down",a,hero)}else hero.top<=(numberOfRows-2)*cellSize&&"blocked"!==o.contents?(cooldown(hero,hero.cooldownTimer),map[hero.row-1][hero.col-1].hero=!1,hero.top+=cellSize,heroContainer.style.transform="translate("+hero.left+"px, "+hero.top+"px)",hero.row++,hero.squaresMoved++,map[hero.row-1][hero.col-1].hero=!0,checkForTraps(),checkForLoot()):checkForAttack("down",o,hero)}else if("move-left"===e)if(1===hero.col);else{var o=map[hero.row-1][hero.col-2];if(o.enemy.length>0){var r=o.enemy[0],a=enemies.filter(function(e){return e.id===r})[0];checkForAttack("left",a,hero)}else hero.left>=cellSize&&"blocked"!==o.contents?(cooldown(hero,hero.cooldownTimer),map[hero.row-1][hero.col-1].hero=!1,hero.left-=cellSize,heroContainer.style.transform="translate("+hero.left+"px, "+hero.top+"px)",hero.col--,hero.squaresMoved++,map[hero.row-1][hero.col-1].hero=!0,checkForTraps(),checkForLoot()):checkForAttack("left",o,hero)}else if("move-right"===e)if(hero.col===numberOfColumns);else{var o=map[hero.row-1][hero.col];if(o.enemy.length>0){var r=o.enemy[0],a=enemies.filter(function(e){return e.id===r})[0];checkForAttack("right",a,hero)}else hero.left<=(numberOfColumns-2)*cellSize&&"blocked"!==o.contents?(cooldown(hero,hero.cooldownTimer),map[hero.row-1][hero.col-1].hero=!1,hero.left+=cellSize,heroContainer.style.transform="translate("+hero.left+"px, "+hero.top+"px)",hero.col++,hero.squaresMoved++,map[hero.row-1][hero.col-1].hero=!0,checkForTraps(),checkForLoot()):checkForAttack("right",o,hero)}hero.location="r"+hero.row+"c"+hero.col,hero.location===levelExit.id&&hero.answers>=hero.answersNeeded&&(hero.bossLevel&&hero.bossIsDead||hero.bossLevel===!1)&&(hero.canMove=!1,hero.gameLevel++,hero.bossLevel&&hero.bossIsDead&&hero.knights.splice(0,3),options.tutorial&&(options.tutorial=!1),localStorage.setItem("savedGame",JSON.stringify(hero)),localStorage.setItem("options",JSON.stringify(options)),0===hero.knights.length?(options.endgame=!0,startGame()):(awardXp("level"),startGame()))}}function flashHitImage(e,t,o){t=e===hero?player:document.querySelector("#"+e.location);var r=document.createElement("img");r.src="img/hit.gif",r.classList.add("hit"),t.appendChild(r),setTimeout(function(){r.remove()},350)}function checkForAttack(e,t,o){if(o===hero&&(keyboardPlayer?cooldown(hero,hero.cooldownAttackTimer):cooldown(hero,hero.cooldownTimer)),t.hasOwnProperty("health"))if(randomNumber(1,100)>t.evasion){if(t.health>0){var r=document.getElementById(t.id);t.hero&&(r=player),flashHitImage(t,r,e);var a=document.getElementById(o.id),n=o.top;o.left;if("up"===e){var i=a.style.zIndex;a.style.zIndex=25,a.style.transform="translate("+o.left+"px, "+(o.top-cellSize/2)+"px)",setTimeout(function(){a.style.transform="translate("+o.left+"px, "+n+"px)",setTimeout(function(){a.style.zIndex=i},200)},200)}else"down"===e?(a.style.transform="translate("+o.left+"px, "+(o.top+cellSize/2)+"px)",setTimeout(function(){a.style.transform="translate("+o.left+"px, "+n+"px)"},200)):"left"===e?(a.style.transform="translate("+(o.left-cellSize/2)+"px, "+o.top+"px)",setTimeout(function(){a.style.transform="translate("+o.left+"px, "+n+"px)"},200)):"right"===e&&(a.style.transform="translate("+(o.left+cellSize/2)+"px, "+o.top+"px)",setTimeout(function(){a.style.transform="translate("+o.left+"px, "+n+"px)"},200));if(t===hero)dealDamage(o.baseDamage,o);else{if(t.health-=o.baseDamage*o.attackRating,t.boss){if("Red Knight"===t.type)var l=document.getElementById("boss-health-redknight");else if("Blue Knight"===t.type)var l=document.getElementById("boss-health-blueknight");else if("Yellow Knight"===t.type)var l=document.getElementById("boss-health-yellowknight");else var l=document.getElementById("boss-health");l.style.opacity="1",l.style.width=t.health/t.startingHealth*100+"%"}if(t.health<=0)if(t.object){delete map[t.row-1][t.col-1].health;var s=document.querySelector("#"+t.location+" img");if(s.style.opacity="0",s.parentElement.classList.remove("torch"),"wall"===t.object){var m=columnArray.map(function(e){return e.location}).indexOf(t.location);columnArray.splice(m,1),t.contents="empty"}else rollLoot(t)}else{map[t.row-1][t.col-1].enemy.splice(0,1);var c=enemies.map(function(e){return e.id}).indexOf(t.id);enemies.splice(c,1),r.style.opacity="0",setTimeout(function(){r.remove()},350)}}}}else t===hero?(hero.attacksEvaded++,flashMessage(t,"evaded!")):flashMessage(t,"miss!")}function flashMessage(e,t,o){var r=document.querySelector("#"+e.id+" .message");if(!(null===r||hero.health<=0)){if(r.innerHTML=t,r.style.display="flex",r.style.opacity="0",o)var a=o/1e3;else var a=.7;r.style.animation="flash-message "+a+"s 1 forwards",setTimeout(function(){r.style.display="none"},1e3*a)}}function dealDamage(e,t){if(t.hasOwnProperty("attackRating")&&(e*=t.attackRating),e*=hero.armorRating,hero.health-=e,hero.health<=0){var o=map[hero.row-1][hero.col-1];if("trap"===t){if("spikes"===o.object)var r=deathText.spikes[randomNumber(0,deathText.spikes.length-1)];else if("fire-grate"===o.object)var r=deathText.fireGrate[randomNumber(0,deathText.fireGrate.length-1)];else if(o.trapType)var r="Slipped and fell on some "+o.trapType}else if("wrong answer"===t)var r=deathText.math[randomNumber(0,deathText.math.length-1)];else if("time"===t)var r=deathText.time[randomNumber(0,deathText.time.length-1)];else if(t.enemy)if("Bat"===t.type)var r=deathText.bat[randomNumber(0,deathText.bat.length-1)];else if("Gelatinous Cube"===t.type)var r=deathText.gelCube[randomNumber(0,deathText.gelCube.length-1)];else if("Giant Spider"===t.type)var r=deathText.spider[randomNumber(0,deathText.spider.length-1)];else if("Number Mage"===t.type)var r=deathText.numMage[randomNumber(0,deathText.numMage.length-1)];else if("Oculord"===t.type)var r=deathText.oculord[randomNumber(0,deathText.oculord.length-1)];else if("Vampire"===t.type)var r=deathText.vampire[randomNumber(0,deathText.vampire.length-1)];else if("Spider Queen"===t.type)var r=deathText.spiderQueen[randomNumber(0,deathText.spiderQueen.length-1)];else if("Vampire Lord"===t.type)var r=deathText.vampireLord[randomNumber(0,deathText.vampireLord.length-1)];else if("Red Knight"===t.type||"Blue Knight"===t.type||"Yellow Knight"===t.type)var r=deathText.threeKnights[randomNumber(0,deathText.threeKnights.length-1)];youDied(r)}else healthBar.style.width=hero.health+"%"}function textBubble(e,t){void 0===t&&(t=2e3),"done"===multipart&&(multipart=0),hero.pause=!0,hero.canMove=!1,tutorialData.proceed=!1,setTimeout(function(){var o=document.getElementById("level-splash");o.innerHTML="",o.style.opacity="0",o.style.display="flex";var r=document.createElement("div");if(r.style.backgroundColor="rgba(0,0,0,0.8)",Array.isArray(e)&&multipart<e.length)"theend"===e[0]?r.innerHTML="<h5>- The End -</h5>":r.innerHTML=e[multipart],multipart++;else if("rescue"===e){var a=document.createElement("p");a.style.color=hero.knights[0].color,a.innerHTML=hero.knights[0].rescueText,r.appendChild(a);var n=document.createElement("p");n.style.color=hero.knights[1].color,n.innerHTML=hero.knights[1].rescueText,r.appendChild(n);var i=document.createElement("p");i.style.color=hero.knights[2].color,i.innerHTML=hero.knights[2].rescueText,r.appendChild(i)}else r.innerHTML=e;setTimeout(function(){o.addEventListener("click",function(){o.style.animation="fade-in 1s 1 forwards",setTimeout(function(){tutorialData.proceed=!0,hero.canMove=!0,hero.pause=!1,o.style.display="none",Array.isArray(e)&&multipart<e.length?textBubble(e,t):multipart>=e.length&&(multipart="done")},1e3)})},1e3),o.appendChild(r),o.style.animation="fade-out 1s 1 forwards"},t)}function startTutorial(){function e(){hero.squaresMoved=0;var e=setInterval(function(){if(hero.squaresMoved>=2){clearInterval(e);var t="Great. Now auto move to the highlighted square by tapping on it.";tutorialData.highlightedSquare=map[0][numberOfColumns-1].location,textBubble(t,0),setTimeout(function(){var e=document.getElementById(tutorialData.highlightedSquare);e.style.border="2px solid rgba(0,0,0,0)",e.style.borderRadius="6px",e.style.transition="border-color 1s",e.style.borderColor="rgba(255,215,0,1)"},1e3)}},250),o=setInterval(function(){if(hero.location===map[0][numberOfColumns-1].location){clearInterval(o);var e="See those 2 traps? Go step on one and see what happens.";textBubble(e,0),setTimeout(function(){var e=document.getElementById(tutorialData.highlightedSquare);e.style.borderColor="rgba(47,45,37,0.5)";var o=[];o.push(moveUp,moveRight,moveDown,moveLeft);for(var r=0;r<o.length;r++)o[r].style.animation="fade-in 0.5s 1 forwards";setTimeout(function(){for(var e=0;e<o.length;e++)o[e].style.opacity=0;t()},500)},500)}},250)}function t(){hero.squaresMoved=0,hero.evasion=0,document.getElementById("healthbar").style.opacity=1;for(var e=0;e<2;e++)document.getElementById(trapArray[e].location).style.border="2px solid rgba(0,0,0,0)",document.getElementById(trapArray[e].location).style.borderRadius="6px",document.getElementById(trapArray[e].location).style.transition="border-color 1s",document.getElementById(trapArray[e].location).style.borderColor="rgba(226,39,39,1)";var t=setInterval(function(){if(hero.squaresMoved>=2){clearInterval(t);for(var e=0;e<2;e++)document.getElementById(trapArray[e].location).style.borderColor="rgba(47,45,37,0.5)";
}},250),r=setInterval(function(){if(hero.health<100){clearInterval(r);var e="Ouch! Break open one of these containers and find something to heal yourself with.";textBubble(e,500),hero.evasion=100,o()}},250)}function o(){var e=document.getElementById(map[0][0].location),t=document.getElementById(map[numberOfRows-1][numberOfColumns-1].location),o=[];o.push(e,t);for(var a=0;a<2;a++)o[a].style.border="2px solid rgba(0,0,0,0)",o[a].style.borderRadius="6px",o[a].style.transition="border-color 1s",o[a].style.borderColor="rgba(255,215,0,1)";hero.squaresMoved=0;var n=setInterval(function(){if(hero.squaresMoved>0)for(var e=document.querySelectorAll(".cell"),t=0;t<e.length;t++)e[t].style.borderColor="rgba(47,45,37,0.5)";100===hero.health&&(clearInterval(n),r())},250)}function r(){function e(){var e="Stand on top of the nearest Multiple of 10, and capture the tile by tapping on your player, or by pressing the spacebar.";textBubble(e,500),hero.canCapture=!0;var t=setInterval(function(){if(hero.answers>0){var e="Great! Now capture a few more.";textBubble(e,0),clearInterval(t)}},250),o=setInterval(function(){hero.answers>2&&tutorialData.proceed&&(a(),clearInterval(o))},250)}var t="What would a dungeon be without math?";textBubble(t,1e3);var o=document.querySelectorAll(".cell p"),r=0,n=setInterval(function(){r>=o.length?(clearInterval(n),document.querySelector("#top-bar .btn-options").style.pointerEvents="auto",document.getElementById("top-bar").style.opacity=1,e()):tutorialData.proceed&&(o[r].style.opacity=1,r++)},100)}function a(){hero.canCapture=!1,hero.enemiesSlain=0;var e="It wouldn't be a proper dungeon without monsters now would it?";textBubble(e,0);var t=setInterval(function(){if(tutorialData.proceed){letTheGamesBegin(),document.getElementById("xpbar").style.opacity=1,clearInterval(t);var e="Stand next to an enemy and tap on it to attack. Watch out for the pools of acid!";textBubble(e,2500)}},250),o=setInterval(function(){if(hero.enemiesSlain>0){hero.canCapture=!0;var e="To proceed deeper into the dungeon capture any remaining tiles.";textBubble(e,0),clearInterval(o),n()}},250)}function n(){var e=setInterval(function(){if(hero.answers>=hero.answersNeeded){var t=["Your training is complete, but your journey is just beginning...","You are the only remaining Number Knight. The others have all been captured by the foul beasts within this dungeon.","It is up to you and you alone to rescue them and return peace and safety to this world once again.<br /><br />Good luck!"];textBubble(t,500),clearInterval(e)}},250),t=setInterval(function(){"done"===multipart&&setTimeout(function(){clearInterval(t),options.tutorial=!1,options.newgame=!1,openExitCover(),restoreHealth(100),hero.evasion=10},1e3)},250)}var i="Welcome to Number Knight!<br />Tap here to get started.";textBubble(i),hero.evasion=100,hero.canCapture=!1;var l=setInterval(function(){if(tutorialData.proceed){clearInterval(l);var t=[];t.push(moveUp,moveRight,moveDown,moveLeft);var o=0,r=setInterval(function(){o>=t.length?clearInterval(r):(t[o].style.animation="fade-out 0.5s 1 forwards",o++)},250),a="Tap the arrows to move around, or use the arrow keys if you have a keyboard.";textBubble(a,2e3),e()}},250)}function youDied(e){healthBar.style.width="0",hero.death=e,fallenHeroes.push(hero),fallenHeroes.sort(function(e,t){return t.gameLevel-e.gameLevel}),fallenHeroes.length>25&&fallenHeroes.splice(fallenHeroes.length,1),localStorage.setItem("fallenHeroes",JSON.stringify(fallenHeroes)),localStorage.setItem("options",JSON.stringify(options)),localStorage.removeItem("savedGame"),listFallenStats(hero,"game-over"),hero=null,hero={canMove:!1}}function fadeToMainMenu(e){fadeOut(),setTimeout(function(){try{map=null,enemies=null,numberOfEnemies=0,totalWeight=0,hero.canMove=!1,hero.challengeMode=!1,hero.bossLevel=!1,hero.bossHasSpawned=!1,hero.bossIsDead=!1,optionsPosition="closed",document.getElementById("options-menu").style.transform="translateX(-100%)";var t=document.querySelector(".flip-container");t.style.display="flex";var o=document.getElementById("game-over");o.style.display="none",o.style.opacity="0",titleButtons(),setTimeout(function(){e()},500)}catch(r){}},1e3)}function theEnd(){heroContainer.style.opacity="0";var e=document.getElementById("top-bar");e.style.opacity="0";var t=document.getElementById("bottom-bar");t.style.opacity="0",hero.canMove=!1,fadeIn();var o=["The Number Knights have been reunited and are now stronger than ever.","The evil beasts within this dungeon have all been slain, and peace has once again returned to this world.","Thank you for playing!"];textBubble(o);var r=setInterval(function(){if("done"===multipart){clearInterval(r);var o=["theend"];textBubble(o,3e3);var a=setInterval(function(){"done"===multipart&&(clearInterval(a),youDied("Quest Complete"),setTimeout(function(){heroContainer.style.opacity="1",e.style.opacity="1",t.style.opacity="1"},1e3),options.endgame=!1,localStorage.setItem("options",JSON.stringify(options)))},500)}},500)}function rollLoot(e){if(options.tutorial||randomNumber(1,100)<=lootChance){var t=loot[randomNumber(0,loot.length-1)],o=t.amount[randomNumber(0,t.amount.length-1)];options.tutorial&&options.newgame&&(t=loot[0],o=t.amount[2]);var r={type:t.type,amount:o},a=map[e.row-1][e.col-1];a.contents="loot",a.loot=r;var n=document.getElementById(e.location),i=document.createElement("img");i.src="img/loot/"+r.type+"-"+o+".gif",i.style.width="50%",n.appendChild(i)}else e.contents="empty"}function restoreHealth(e){hero.health>=100||(hero.health+e<=100?hero.health+=e:hero.health=100),healthBar.style.width=hero.health+"%"}function freezePerson(e,t,o){e.canMove=!1,e.frozen=!0;var r=document.getElementById("hero-status");r.style.width="100%","ice"===o?(hero.hero&&hero.timesFrozen++,flashMessage(e,"frozen!",t),r.style.backgroundColor="#8aeaea"):r.style.backgroundColor="#24e35a",r.style.display="flex",r.style.animation="status-effect "+t/1e3+"s linear 1 forwards",setTimeout(function(){r.style.display="none",e.canMove=!0,e.frozen=!1},t)}function checkForTraps(){var e=map[hero.row-1][hero.col-1];if(randomNumber(1,100)<hero.evasion&&"trap"===e.contents)hero.trapsEvaded++,flashMessage(hero,"evaded!");else if("ice"===e.trapType){var t=e.trapDuration;freezePerson(hero,t,"ice"),flashMessage(hero,"frozen!",t)}else if("web"===e.trapType){hero.timesWebbed++;var t=e.trapDuration;freezePerson(hero,t,"web"),flashMessage(hero,"trapped!",t)}else"trap"===e.contents&&(flashHitImage(hero,player),dealDamage(e.trapDamage,"trap"))}function checkForLoot(){var e=map[hero.row-1][hero.col-1];if("loot"===e.contents){var t=document.querySelectorAll("#"+e.location+" img");if("health"===e.loot.type&&hero.health<100){restoreHealth(options.tutorial&&options.newgame?100:e.loot.amount),e.contents="empty";for(var o=0;o<t.length;o++)t[o].remove()}else if("gold"===e.loot.type){options.gold+=e.loot.amount,e.contents="empty";for(var o=0;o<t.length;o++)t[o].remove()}}}function awardXp(e){if("level"===e?setTimeout(function(){hero.xp+=15,xpBar.style.width=hero.xp+"%",localStorage.setItem("savedGame",JSON.stringify(hero))},2500):(hero.xp+=Math.floor(.5/hero.level*e.weight),xpBar.style.width=hero.xp+"%"),hero.xp>=100){hero.xp-=100,hero.level++,xpBar.style.width=hero.xp+"%";var t=document.getElementById("level");t.innerHTML="Level Up!",t.classList.add("level-up"),t.addEventListener("click",levelUp),restoreHealth(100)}}function levelUp(){hero.pause=!0;var e=[0,0,1.2,1.5,1.9,2.5],t=[0,0,18,28,40,55],o=[0,0,.95,.85,.72,.5],r="",a=document.getElementById("level-up-menu");a.style.backgroundImage='url("img/backgrounds/background-0'+randomNumber(1,backgrounds)+'.gif")',a.style.display="flex",a.style.animation="img-fade-in 1s 1 forwards";var n=document.querySelector(".strength div span");n.innerHTML="lvl "+hero.strength;var i=document.querySelector(".dexterity div span");i.innerHTML="lvl "+hero.dexterity;var l=document.querySelector(".endurance div span");l.innerHTML="lvl "+hero.endurance;var s=document.querySelectorAll("#level-up-menu .row"),m=document.getElementById("add-str");hero.strength===e.length-1?(n.innerHTML="MAX",m.innerHTML=Math.round(hero.baseDamage*hero.attackRating)):m.innerHTML=Math.round(hero.baseDamage*hero.attackRating)+" -> "+Math.round(hero.baseDamage*e[hero.strength+1]);var c=document.getElementById("add-dex");hero.dexterity===t.length-1?(i.innerHTML="MAX",c.innerHTML=hero.evasion+"%"):c.innerHTML=hero.evasion+"% -> "+t[hero.dexterity+1]+"%";var d=document.getElementById("add-end");hero.endurance===o.length-1?(l.innerHTML="MAX",d.innerHTML=100*hero.armorRating+"%"):d.innerHTML=100*hero.armorRating+"% -> "+100*o[hero.endurance+1]+"%";for(var h=0;h<s.length;h++)s[h].addEventListener("click",function(e){for(var t=0;t<s.length;t++)s[t].style.backgroundColor="rgba(0,0,0,0)",s[t].style.outlineColor="rgba(0,0,0,0)";this.style.backgroundColor="rgba(255,255,255,0.07)",this.style.outlineColor="#ffd700",r=this.classList[1]});var u=document.querySelector("#level-up-menu button");u.addEventListener("click",function(){var n=!1;if("strength"===r&&hero.strength<e.length-1?(hero.strength++,hero.attackRating=e[hero.strength],n=!0):"dexterity"===r&&hero.dexterity<t.length-1?(hero.dexterity++,hero.evasion=t[hero.dexterity],n=!0):"endurance"===r&&hero.endurance<o.length-1&&(hero.endurance++,hero.armorRating=o[hero.endurance],n=!0),n){var i=document.getElementById("level");i.innerHTML="Floor "+hero.gameLevel,i.classList.remove("level-up"),i.removeEventListener("click",levelUp),a.style.animation="img-fade-out 1s 1 forwards",setTimeout(function(){for(var e=0;e<s.length;e++)s[e].removeEventListener("click",function(e){});a.style.display="none",hero.pause=!1},1e3);for(var l=0;l<s.length;l++)s[l].style.backgroundColor="rgba(0,0,0,0)",s[l].style.outlineColor="rgba(0,0,0,0)";r=null;var m=u.cloneNode(!0);u.parentNode.replaceChild(m,u)}})}function cooldown(e,t){e.hero?hero.canMove=!1:e.cooldown=!0,setTimeout(function(){e.hero?hero.frozen||(hero.canMove=!0):e.cooldown=!1},t)}function getAccuracy(e,t){return 0!==e||0!==t?Math.floor(e/(e+t)*100)+"&#37;":"--"}function randomNumber(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function cheat(){hero.answers=hero.answersNeeded-1,hero.gameLevel=5,options.gold+=350}var maxScreenWidth=768,numberOfColumns=5,maxColumns=7,maxRows=9,reservedSpace=150,reservedSides=15,correctMinThreshold=25,correctMaxThreshold=60,healthRestoreFromCapture=1,timeRestoreFromCapture=3,timeLostFromWrongAnswer=0,defaultTimer=60,heroBaseDamage=25,damageFromWrongAnswer=20,damageFromTraps=15,keyboardPlayer=!1,keyboardDamageModifier=1.5,chanceToSpawnTrap=80,backgrounds=2,tilesets=10,walls=16,empty=6,traps=["fire-grate","spikes"],trapsToBuild=[],debrisToBuild,columnsToBuild,loot=[{type:"health",amount:[5,10,15]},{type:"gold",amount:[1,2,5,10,25]}],lootChance=50,themes=[["pot-1","pot-2","pot-3","pot-4","pot-5","pot-6","bones-1","bones-3","bones-4","bones-5","bones-6","bones-7","barrel-1","barrel-2","box-1","box-2","table-1","table-2","shelf-1","weapons-1","weapons-2"],["bones-3","bones-4","bones-5","chair-1","chair-2","table-1","table-2","shelf-1","shelf-2"],["fence-1","fence-2","bones-1","bones-2","bones-3","bones-4","bones-5","bones-6","bones-7","coffin-1","coffin-2","coffin-3","grave-1","grave-2","grave-3","grave-4","grave-5","grave-6","monument-1","monument-2","monument-3","monument-4","vase-1","vase-2"],["fence-1","fence-2","tree-1","tree-2","bush-1","bush-2","bones-1","bones-2","bones-3","bones-4","bones-5","bones-6","bones-7","coffin-1","coffin-2","coffin-3","grave-1","grave-2","grave-3","grave-4","grave-5","grave-6","monument-1","monument-2","monument-3","monument-4"],["fence-1","fence-2","tree-1","tree-2","bush-1","bush-2","bones-1","bones-2"]],gameMode=["multiples","factors","primes","equality"],challengeMode=["ascending","descending"],maxWeight=0,totalWeight=0,numberOfEnemies=0,maxEnemies=0,enemies=[];if(function(){function e(){clearInterval(o),t.style.animation="img-fade-out 1.25s 1 forwards",t.parentElement.style.animation="img-fade-out 0.75s 1.75s 1 forwards",setTimeout(function(){t.parentElement.style.display="none"},2500)}var t=document.querySelector("#splash img");t.style.animation="img-fade-in 1.25s 1s 1 forwards",setTimeout(function(){t.parentElement.addEventListener("click",e)},1250);var o=setTimeout(function(){e()},5e3)}(),null===localStorage.getItem("options"))options={version:20161216,newgame:!0,tutorial:!0,endgame:!1,soundfx:!0,music:!0,enemiesEncountered:[],newEnemies:0,gold:0,avatars:["hero"],storeItems:[{id:"avatars-01",type:"avatars",item:"Elite Knights",cost:100,imagePath:"img/avatars/",images:["roman-gold","roman-silver"],owned:!1},{id:"avatars-02",type:"avatars",item:"Wolf Rangers",cost:100,imagePath:"img/avatars/",images:["wolf-grey","wolf-brown"],owned:!1}]};else{var retrievedList=localStorage.getItem("options");options=JSON.parse(retrievedList)}if(null===localStorage.getItem("fallenHeroes"))fallenHeroes=[];else{var retrievedList=localStorage.getItem("fallenHeroes");fallenHeroes=JSON.parse(retrievedList)}var screenWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;screenWidth>maxScreenWidth&&(screenWidth=maxScreenWidth),screenWidth>=maxScreenWidth&&(numberOfColumns=maxColumns);var screenHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;screenWidth-=2*reservedSides;var cellSize=Math.floor(screenWidth/numberOfColumns),numberOfRows=Math.floor((screenHeight-reservedSpace)/cellSize);numberOfRows>maxRows&&(numberOfRows=maxRows);var totalCells=numberOfColumns*numberOfRows,cellFontSize=cellSize/5+"px",uiWidth=numberOfColumns*cellSize+"px",topBar=document.getElementById("top-bar");topBar.style.width=uiWidth;var bottomBar=document.getElementById("bottom-bar");bottomBar.style.width=uiWidth;var optionsPosition="closed",levelContainer=document.getElementById("level-container");levelContainer.style.width=numberOfColumns*cellSize+"px";var heroContainer=document.getElementById("hero-container"),player=document.getElementById("hero");player.addEventListener("click",checkMath);var healthBar=document.getElementById("health"),timeBar=document.getElementById("time"),xpBar=document.getElementById("xp"),avatarSelection="hero";titleScreen();var soundfx=document.getElementById("soundfx"),music=document.getElementById("music");soundfx.addEventListener("click",setOptions),music.addEventListener("click",setOptions),options.soundfx?soundfx.checked=!0:soundfx.checked=!1,options.music?music.checked=!0:music.checked=!1;var mathradio=document.querySelectorAll("#math-difficulty input");mathradio[0].checked=!0;for(var i=0;i<mathradio.length;i++)mathradio[i].addEventListener("click",adjustDifficulty);var monsterradio=document.querySelectorAll("#monster-difficulty input");monsterradio[0].checked=!0;for(var i=0;i<monsterradio.length;i++)monsterradio[i].addEventListener("click",adjustDifficulty);var fallenButton=document.getElementById("btn-fallen-heroes");fallenButton.addEventListener("click",displayHeroes);var goldButton=document.querySelector(".gold-total");goldButton.addEventListener("click",openStore);var bestiary=[{type:"Bat",boss:!1,image:"bat.gif",baseDamage:2,health:30,weight:10,evasion:10,moveInterval:1500,moveSpeed:.5,moveType:"aggressive",info:"Bats are quick, and not much of a threat alone, but can easily overcome you in larger numbers. They can also fly over obstacles to reach you."},{type:"Gelatinous Cube",boss:!1,image:"cube-green.gif",baseDamage:10,health:50,weight:20,evasion:5,moveInterval:2100,moveSpeed:2,moveType:"passive",abilities:[{ability:"acid",abilityDamge:5,abilityDuration:5500,abilityChance:100}],info:"A slow moving gelatinous mass that leaves a trail of corrosive acid in its wake."},{type:"Giant Spider",boss:!1,image:"spider.gif",baseDamage:10,health:65,weight:30,evasion:15,moveInterval:2e3,moveSpeed:.35,moveType:"passive",abilities:[{ability:"web",abilityDamge:0,trapDuration:3e3,abilityDuration:12e3,abilityChance:20}],info:"Spiders are quick, and can poison you with their bite. The webs they leave behind can immobilize you for a short period of time."},{type:"Number Mage",boss:!1,image:"number-mage.gif",baseDamage:5,health:85,weight:20,evasion:10,moveInterval:3e3,moveSpeed:.5,moveType:"passive",abilities:[{ability:"rotate",abilityDamge:0,abilityDuration:1e4,abilityChance:80}],info:"The Number Mage is not a threat in the usual sense. They do almost no damage, but cast magic to cloud your mind and make equations more difficult to solve."},{type:"Oculord",boss:!1,image:"oculord.gif",baseDamage:15,health:100,weight:60,evasion:10,moveInterval:3e3,moveSpeed:2.5,moveType:"passive",abilities:[{ability:"projectile",abilityImage:["projectile-fire.gif","projectile-ice.gif"],abilityDamge:15,damageDuration:3e3,abilityDuration:.45,abilityChance:75,targetChance:75}],info:"Oculords can shoot both ice and fire from one of the many magical eye stalks that grow from their bodies."},{type:"Vampire",boss:!1,image:"vampire.gif",baseDamage:15,health:125,weight:60,evasion:10,moveInterval:3e3,moveSpeed:1,moveType:"passive",abilities:[{ability:"invisibility",abilityDamge:.6,abilityDuration:1e4,abilityChance:70}],info:"These blood sucking fiends have the ability to turn mostly invisible for a period of time. While under this effect they can drain your life within a short range."}],bosses=[{type:"Spider Queen",boss:!0,image:"spider-queen.gif",baseDamage:15,health:500,weight:50,evasion:5,moveInterval:2100,moveSpeed:2,moveType:"passive",abilities:[{ability:"acid",abilityDamge:5,abilityDuration:5500,abilityChance:80},{ability:"projectile",abilityImage:["projectile-poison.gif"],abilityDamge:1.15,damageDuration:3e3,dotStatus:"poisoned!",abilityDuration:.45,abilityChance:90,targetChance:100}],info:"The Spider Queen resides in a large lair within these dungeon walls. She has a powerful poison, and many smaller minions that will stop at nothing to protect their Queen."},{type:"Vampire Lord",boss:!0,image:"vampire-lord.gif",baseDamage:10,health:500,weight:70,evasion:5,moveInterval:1900,moveSpeed:1.5,moveType:"passive",abilities:[{ability:"invisibility",abilityDamge:.9,abilityDuration:7e3,abilityChance:70},{ability:"projectile",abilityImage:["projectile-ice.gif"],abilityDamge:5,damageDuration:1900,dotStatus:"frozen!",abilityDuration:.45,abilityChance:100,targetChance:100}],info:"The Vampire Lord has a powerful short range life drain ability while he remains invisible. His ice projectiles can freeze you in place so that his swarm of bat minions can overtake you."},{type:"Red Knight",boss:!0,image:"red-knight.gif",baseDamage:10,health:225,weight:50,evasion:5,moveInterval:2200,moveSpeed:1.2,moveType:"passive",cooldownTimer:4e3,abilities:[{ability:"burst",abilityImage:["projectile-fire.gif"],abilityDamge:8,damageDuration:3e3,abilityDuration:.35,burstSpeed:350,shots:0,abilityChance:85,targetChance:100}],info:"The first of the Three Knights, the Red Knight hurls fireballs in rapid bursts to deal immense damage to their victim."},{type:"Blue Knight",boss:!0,image:"blue-knight.gif",baseDamage:10,health:225,weight:50,evasion:5,moveInterval:2200,moveSpeed:1.2,moveType:"passive",abilities:[{ability:"ice",abilityDamge:5,trapDuration:1e3,abilityDuration:5500,abilityChance:80},{ability:"projectile",abilityImage:["projectile-ice.gif"],abilityDamge:10,damageDuration:2500,dotStatus:"frozen!",abilityDuration:.9,abilityChance:100,targetChance:100}],info:"The second of the Triumvarate, the Blue Knight leaves a trail of ice, and can shoot freezing orbs, locking their victim in place."},{type:"Yellow Knight",boss:!0,image:"yellow-knight.gif",baseDamage:10,health:225,weight:50,evasion:5,moveInterval:2200,moveSpeed:1.2,moveType:"passive",abilities:[{ability:"projectile",abilityImage:["projectile-poison.gif"],abilityDamge:1.25,damageDuration:3e3,dotStatus:"poisoned!",abilityDuration:.45,abilityChance:90,targetChance:100}],info:"The last of the three guardians, the Yellow Knight launches a powerful poisoned ball that deals damage over time to the effected victim."}],moveUp=document.getElementById("move-up");moveUp.addEventListener("mousedown",function(e){hero.fastTravel?hero.fastTravel=!1:moveHero("move-up"),keyboardPlayer=!1});var moveDown=document.getElementById("move-down");moveDown.addEventListener("mousedown",function(e){hero.fastTravel?hero.fastTravel=!1:moveHero("move-down"),keyboardPlayer=!1});var moveLeft=document.getElementById("move-left");moveLeft.addEventListener("mousedown",function(e){hero.fastTravel?hero.fastTravel=!1:moveHero("move-left"),keyboardPlayer=!1});var moveRight=document.getElementById("move-right");moveRight.addEventListener("mousedown",function(e){hero.fastTravel?hero.fastTravel=!1:moveHero("move-right"),keyboardPlayer=!1}),document.onkeydown=checkKey;for(var rescueText=["Hail, and well met!","You&apos;re here to rescue us? Inconceivable!","You are the greatest swordsman that ever lived!","Thank you!","It was starting to get really boring in here...","This place totally stinks, thank you for rescuing us!","I can&apos;t wait to go home and get on the internet again!","I knew you would come for us!","You&apos;re awesome!","I hate spiders!","I thought we were done for!","Did you bring anything to eat with you? I&apos;m starving!","You&apos;re the coolest.","Have you found the others?","You were always my favorite. Thank you!"],multipart=0,tutorialData={proceed:!1,tilesetOutside:9,tilesetInside:6,exitLocation:[numberOfRows-1,2],numDebris:2,numColumns:2,numTraps:2,objectTheme:themes[1],wallTileset:5,wallLocation:[[1,1],[1,numberOfColumns-2]],trapLocation:[[numberOfRows-2,1],[numberOfRows-2,numberOfColumns-2]],heroTop:3*cellSize,heroLeft:2*cellSize,heroRow:4,heroCol:3,heroLocation:"r4c3",gameMode:"multiples",target:10},deathText={spikes:["Tripped and fell on some spikes.","Landed heart first on a spike.","Felt the need to add another hole to their face.","Got into a fight with some spikes and lost.","Death by spikes.","Tried to make out with some spikes and was very successful."],fireGrate:["Got a little too fired up by a fire grate.","Got served up extra crispy by a fire grate.","Cooked to perfection by a fire grate.","Killed by a fire grate.","Tripped and fell into a fire grate.","Do you smell what the dungeon is cookin? Fire grate does."],math:["Forgot how to math.","Left their calculator at home.","Didn&apos;t pay attention in math class.","Got mathed upside the head.","Got in a fight with a number and lost.","Couldn&apos;t math their way out of a paper bag.","Death by math.","Killed by numbers.","Math is hard."],time:["Ran out of time."],bat:["Nibbled to death by a bat.","Killed by a flying rat.","Got one too many bats to the face.","Death by bats.","Lost a fight to a bat.","Ran into a bats mouth face first."],gelCube:["Ate too much Jell-O.","Run over by a Gelatinous Cube.","Got a big ole hug from a Gelatinous Cube.","Got into a fatal makeout session with a Gelatinous Cube.","Being slowly digested and turned into Gelatinous Cube poop.","Trapped in a Gelatinous Cube of emotion."],spider:["Killed by a spider. A big one.","I hate spiders. Why did I put them in my game??","Not very good at making friends with spiders.","Food for the Spider Queen.","Spiders are very aggressive huggers.","Tripped and fell into a spiders mouth."],numMage:["Killed by the weakest enemy in the entire game.","Got out numbered by a Number Mage.","Death by Number Mage.","Do Number Mages even deal damage?"],oculord:["Looked too deeply into the all seeing eye of the Oculord.","Beat up by a giant meatball.","Died valiantly while battling an Oculord.","Death by Oculord.","Eaten by a one-eyed flying meatball.","Put food on the table for a family of Oculords."],vampire:["Killed by a vampire.","Got a very aggressive hickey from a vampire.","Was the main course at the all you can eat vampire buffet.","Decided to help out a starving vampire in need.","Gave a vampire a tall glass of Blood Light.","Got a big sloppy, bloody kiss from a vampire."],spiderQueen:["Food for Spider Queen babies.","I still hate spiders. Why did I put a gigantic one that shoots poison in my game??","Put food on the table for a family of spiders.","Got wrapped up like a Christmas present for some hungry spider kids.","Eaten by a big mommy spider.","Tried to headbutt the Spider Queen, but got eaten instead."],vampireLord:["Killed by the Vampire Lord.","Frozen. Bitten. And drained of all life by the Vampire Lord.","The Vampire Lord does not like non-vampires.","Got turned into a vampire by the Vampire Lord. So I guess that&apos;s pretty cool.","Vampire Lord thanks you for the delicious blood.","More blood for the vampire lord."],threeKnights:["Was defeated by The Three Knights."]},loadingStage=document.getElementById("game-over"),i=1;i<=tilesets;i++)for(var j=1;j<=empty;j++){var img=document.createElement("img");img.src="img/tiles/"+i+"/empty"+j+".gif",img.style.width="1px",img.style.height="1px",loadingStage.appendChild(img)}loadingStage.innerHTML="";